(async function() {
  while (!Spicetify.React || !Spicetify.ReactDOM) {
    await new Promise(resolve => setTimeout(resolve, 10));
  }
  var $={autoEnabled:!1,autoIntervalMs:300000,maxAutosnapshots:15,autoMode:"timer",onlyNewItems:!0,queueWarnEnabled:!0,queueMaxSize:80,queueWarnThreshold:5,promptManualBeforeReplace:!0,language:void 0,settingsCollapsed:!1,syncedSnapshotId:void 0};function Q(){try{let e=Spicetify.LocalStorage.get("queue-manager:settings");if(!e)return $;let n=JSON.parse(e);return{autoEnabled:n.autoEnabled??$.autoEnabled,autoIntervalMs:typeof n.autoIntervalMs==="number"&&n.autoIntervalMs>0?n.autoIntervalMs:$.autoIntervalMs,maxAutosnapshots:typeof n.maxAutosnapshots==="number"&&n.maxAutosnapshots>0?n.maxAutosnapshots:$.maxAutosnapshots,autoMode:n.autoMode==="timer"?"timer":"on-change",onlyNewItems:n.onlyNewItems!==!1,queueWarnEnabled:n.queueWarnEnabled!==!1,queueMaxSize:typeof n.queueMaxSize==="number"&&n.queueMaxSize>1?n.queueMaxSize:$.queueMaxSize,queueWarnThreshold:typeof n.queueWarnThreshold==="number"&&n.queueWarnThreshold>=0?n.queueWarnThreshold:$.queueWarnThreshold,promptManualBeforeReplace:n.promptManualBeforeReplace!==!1,language:typeof n.language==="string"?n.language:void 0,settingsCollapsed:n.settingsCollapsed??$.settingsCollapsed,syncedSnapshotId:typeof n.syncedSnapshotId==="string"?n.syncedSnapshotId:void 0}}catch{return $}}function pe(e){Spicetify.LocalStorage.set("queue-manager:settings",JSON.stringify(e))}var We="queue-manager:snapshots";function k(){try{let e=Spicetify.LocalStorage.get(We);if(!e)return[];let n=JSON.parse(e);if(!Array.isArray(n))return[];return n}catch{return[]}}function je(e){return e.sort((n,i)=>i.createdAt-n.createdAt)}function j(e){je(e),Spicetify.LocalStorage.set(We,JSON.stringify(e))}function ne(){return je(k())}function ke(e){let n=ne(),i=n.filter((c)=>c.type==="manual"),t=n.filter((c)=>c.type==="auto").slice(0,e.maxAutosnapshots),l=n.filter((c)=>c.type==="synced");j([...i,...t,...l])}function de(e,n){let i=n??Q(),t=k(),l=t.filter((o)=>o.type==="manual"),c=t.filter((o)=>o.type==="auto"),p=t.filter((o)=>o.type==="synced");if(e.type==="auto"){let o=[e,...c].slice(0,i.maxAutosnapshots);j([...l,...o,...p])}else j([e,...l,...c,...p])}function Ne(){let e=k(),n=e.filter((t)=>t.type==="manual"),i=e.filter((t)=>t.type==="synced");j([...n,...i])}var Re={name:"queue-manager",version:"0.7.2",private:!0,scripts:{"update-types":"curl -s -o ./src/types/spicetify.d.ts https://raw.githubusercontent.com/spicetify/spicetify-cli/master/globals.d.ts",build:"bun run build.ts","build-local":"bun run build.ts --out=dist --minify",watch:"bun run build.ts --watch"},license:"GPL-3.0",devDependencies:{"@types/bun":"^1.3.7","@types/react":"^19.2.2","@types/react-dom":"^19.2.2","@types/wicg-file-system-access":"^2023.10.7"}};var g="Queue Manager",me="queue-manager",Oe=Re.version??"0.0.0",qe="beta";var Fe={ui:{buttons:{save:"Save",cancel:"Cancel",confirm:"Confirm",delete:"Delete",export:"Export",import:"Import",refresh:"Refresh",view:"View",hide:"Hide",rename:"Rename",resetName:"Reset name",clearAll:"Clear all",exportAll:"Export all",saveNow:"Save now",replaceQueue:"Replace queue",appendToQueue:"Append to queue",exportToPlaylist:"Export to playlist",exportSettings:"Export settings",importSnapshots:"Import snapshots",importSettings:"Import settings",createSyncedSnapshot:"Create synced snapshot",activateSync:"Activate sync",exitSyncMode:"Exit sync mode",convertToManual:"Convert to manual"},labels:{snapshotName:"Snapshot name",toggleItems:"Toggle items",replaceQueue:"Replace the current queue",appendQueue:"Append missing items to queue",exportToPlaylist:"Export to playlist",renameSnapshot:"Rename snapshot",resetName:"Reset name",deleteSnapshot:"Delete snapshot",exportSettings:"Export settings to a JSON file",importSnapshots:"Import snapshots from a JSON file",importSettings:"Import settings from a JSON file",exportAllManuals:"Export all",exportAllAutos:"Export all",clearAllAutos:"Clear all",saveNewManual:"Save now",activeSync:"Active",syncModeDisabledActions:"Disabled during sync mode",convertToManual:"Convert synced snapshot to manual"},sections:{manualSnapshots:"Manual Snapshots",manualSnapshotsCaption:"Your saved queues for later",automaticSnapshots:"Automatic Snapshots",automaticSnapshotsCaption:"Captured in the background",syncedSnapshots:"Synced Snapshots",syncedSnapshotsCaption:"Queue snapshots that sync in real-time",settings:"Settings",settingsCaption:"Customize your experience"},empty:{noManualSnapshots:"No manual snapshots yet",noAutomaticSnapshots:"No automatic snapshots yet",noSyncedSnapshots:"No synced snapshots yet",noSnapshots:"No snapshots yet"},itemSingular:"item",itemPlural:"items",includesLocal:"includes local",loading:"Loading…",failedToLoadItems:"Failed to load items"},snapshots:{types:{auto:"Auto",manual:"Manual",synced:"Synced"},defaults:{myJam:"My jam"},actions:{exporting:"Exporting…",appending:"Appending…",replacing:"Replacing…"}},settings:{autoEnabled:"Enable automatic snapshots",autoMode:"Mode",timeBased:"Time-based",queueChanges:"Queue changes",experimental:"Experimental!",experimentalTooltip:"This mode may create many similar snapshots (for example when queuing a bunch of songs)",onlyNewItems:"Check for new items",onlyNewItemsDescription:"Only trigger it when there is a new song that was not in the previous snapshot.",equalQueuesNote:"Equal queues are never saved as automatic snapshots.",queueWarnEnabled:"Warn when queue is nearly full",queueWarnDescription:"Heuristic limit; includes current track.",promptManualBeforeReplace:"Ask to save manual snapshot before replacing queue",promptManualDescription:"Offers to store the current queue before overwriting it.",interval:"Interval (minutes)",intervalDescription:"Minimum 0.5 (30 seconds)",maxAutomaticSnapshots:"Max automatic snapshots",maxAutomaticDescription:"Older snapshots are pruned. Be careful when changing this",queueMaxSize:"Queue max size",queueMaxSizeDescription:"80 is the current Spotify limit. Only change if Spotify updates this.",queueWarnThreshold:"Warn when remaining slots ≤",language:"Language",languageDescription:"Override the auto-detected language",autoDetected:"Auto-detected"},toasts:{snapshotSaved:"Snapshot saved",snapshotDeleted:"Snapshot deleted: {{name}}",clearedAutomaticSnapshots:"Cleared {{count}} automatic snapshots",exportedToPlaylist:"Exported to {{name}}",addedToQueue:"Added {{count}} {{plural}} to queue",queueReplaced:"Queue replaced ({{count}} items)",settingsImported:"Settings imported successfully.",snapshotsImported:"Imported {{count}} new {{plural}}.",noQueueFound:"No queue found. If you believe this is an error, please try to play and pause a track.",nothingToExport:"Nothing to export",snapshotEmpty:"Snapshot is empty",allItemsAlreadyInQueue:"All snapshot items are already in the queue",failedToSaveSnapshot:"Failed to save snapshot",failedToExport:"Failed to export to playlist",failedToAppend:"Failed to append to queue",failedToReplace:"Failed to replace queue",failedToStartPlayback:"Failed to start playback",failedToSaveAutomatic:"Failed to save an automatic snapshot",failedToStartQueueWatcher:"Failed to start queue update watcher",failedToStartCapacityWatcher:"Failed to start capacity watcher",queueNearlyFull:"Queue nearly full ({{used}}/{{max}})",nameCannotBeEmpty:"Name cannot be empty",nameMustDifferFromDefault:"Name must differ from the default suggestion",noAutomaticSnapshotsToClear:"No automatic snapshots to clear",someImportedSnapshotsInvalid:"Some imported snapshots were invalid and have been skipped.",noValidSnapshotsToImport:"No valid snapshots to import.",allSnapshotsAlreadyExist:"All snapshots already exist.",invalidSettingsFile:"Invalid settings file format.",exportResult:"Exported; some tracks couldn't be added ({{added}}/{{total}})",appendResult:"Added {{added}}/{{total}} items to queue",replaceResult:"Replaced; some items couldn't be queued ({{added}}/{{total}})",exportCanceled:"Export canceled ({{reason}})",exportedToDownloads:"Exported {{filename}} to Downloads folder",failedToExportJson:"Failed to export JSON: {{reason}}",importCanceled:"Import canceled ({{reason}})",failedToImportJson:"Failed to import JSON: {{reason}}",failedToImportJsonAccess:"Failed to import JSON: File is empty or inaccessible",syncActivated:"Sync mode activated",syncDeactivated:"Sync mode deactivated",queueSyncedToSnapshot:"Queue synced to snapshot",syncedSnapshotCreated:"Synced snapshot created",failedToCreateSyncedSnapshot:"Failed to create synced snapshot",failedToActivateSync:"Failed to activate sync mode",failedToStartSyncManager:"Failed to start queue sync manager",queueRestored:"Queue restored from last state",convertedToManual:"Converted to manual snapshot",syncedSnapshotNotFound:"Synced snapshot no longer exists, sync mode deactivated"},dialogs:{saveSnapshot:{title:"Save snapshot",message:"Name this snapshot",confirmLabel:"Save",cancelLabel:"Cancel"},deleteSnapshot:{title:"Delete snapshot",message:"Delete this snapshot? This cannot be undone.",confirmLabel:"Delete"},clearAutomaticSnapshots:{title:"Clear automatic snapshots",message:"Delete all {{count}} automatic snapshots? This cannot be undone.",confirmLabel:"Clear all"},saveCurrentQueue:{title:"Save current queue?",message:"Create a manual snapshot of the current queue before replacing it?",confirmLabel:"Save snapshot",cancelLabel:"Skip",extraLabel:"Cancel"},importSettings:{title:"Import Settings",message:"This will overwrite your current settings. Are you sure?",confirmLabel:"Import"},saveSyncedSnapshot:{title:"Create synced snapshot",message:"Name this synced snapshot. This will use your current queue items and the synced snapshot will be activated automatically.",confirmLabel:"Create",cancelLabel:"Cancel"},emptyQueueDetected:{title:"Empty queue detected",message:"Your queue is now empty. What would you like to do?",restore:"Restore previous state",keepEmpty:"Keep empty",switchSnapshot:"Switch snapshot"},convertToManual:{title:"Convert to manual snapshot",message:"Convert this synced snapshot to a manual snapshot? This will deactivate sync mode if active.",confirmLabel:"Convert"},switchSyncedSnapshot:{title:"Create new synced snapshot",message:"Creating a new synced snapshot will start fresh. Your current queue will be cleared (except the currently playing track). Do you want to continue?",confirmLabel:"Start fresh",cancelLabel:"Cancel"}},errors:{failedToAddTopbarButton:"failed to add topbar button",failedToAddContextMenuItem:"failed to add context menu item",failedToAddKeyboardShortcut:"failed to add keyboard shortcut"}};var Ie={ui:{buttons:{save:"Speichern",cancel:"Abbrechen",confirm:"Bestätigen",delete:"Löschen",export:"Exportieren",import:"Importieren",refresh:"Aktualisieren",view:"Anzeigen",hide:"Ausblenden",rename:"Umbenennen",resetName:"Name zurücksetzen",clearAll:"Alle löschen",exportAll:"Alle exportieren",saveNow:"Jetzt speichern",replaceQueue:"Warteschlange ersetzen",appendToQueue:"Zur Warteschlange hinzufügen",exportToPlaylist:"Als Playlist exportieren",exportSettings:"Einstellungen exportieren",importSnapshots:"Snapshots importieren",importSettings:"Einstellungen importieren",createSyncedSnapshot:"Synchronisierten Snapshot erstellen",activateSync:"Synchronisierung aktivieren",exitSyncMode:"Synchronisierungsmodus beenden",convertToManual:"In manuell umwandeln"},labels:{snapshotName:"Snapshot-Name",toggleItems:"Elemente ein-/ausblenden",replaceQueue:"Die aktuelle Warteschlange ersetzen",appendQueue:"Fehlende Elemente zur Warteschlange hinzufügen",exportToPlaylist:"Als Playlist exportieren",renameSnapshot:"Snapshot umbenennen",resetName:"Name zurücksetzen",deleteSnapshot:"Snapshot löschen",exportSettings:"Einstellungen in eine JSON-Datei exportieren",importSnapshots:"Snapshots aus einer JSON-Datei importieren",importSettings:"Einstellungen aus einer JSON-Datei importieren",exportAllManuals:"Alle exportieren",exportAllAutos:"Alle exportieren",clearAllAutos:"Alle löschen",saveNewManual:"Jetzt speichern",activeSync:"Aktiv",syncModeDisabledActions:"Im Synchronisierungsmodus deaktiviert",convertToManual:"Synchronisierten Snapshot in manuell umwandeln"},sections:{manualSnapshots:"Manuelle Snapshots",manualSnapshotsCaption:"Deine gespeicherten Warteschlangen für später",automaticSnapshots:"Automatische Snapshots",automaticSnapshotsCaption:"Im Hintergrund erfasst",syncedSnapshots:"Synchronisierte Snapshots",syncedSnapshotsCaption:"Warteschlangen-Snapshots, die in Echtzeit synchronisieren",settings:"Einstellungen",settingsCaption:"Deine Erfahrung anpassen"},empty:{noManualSnapshots:"Noch keine manuellen Snapshots",noAutomaticSnapshots:"Noch keine automatischen Snapshots",noSyncedSnapshots:"Noch keine synchronisierten Snapshots",noSnapshots:"Noch keine Snapshots"},itemSingular:"Element",itemPlural:"Elemente",includesLocal:"enthält lokale Dateien",loading:"Lädt…",failedToLoadItems:"Elemente konnten nicht geladen werden"},snapshots:{types:{auto:"Auto",manual:"Manuell",synced:"Synchronisiert"},defaults:{myJam:"Mein Mix"},actions:{exporting:"Exportiere…",appending:"Füge hinzu…",replacing:"Ersetze…"}},settings:{autoEnabled:"Automatische Snapshots aktivieren",autoMode:"Modus",timeBased:"Zeitbasiert",queueChanges:"Warteschlangen-Änderungen",experimental:"Experimentell!",experimentalTooltip:"Dieser Modus kann viele ähnliche Snapshots erstellen (z.B. beim Hinzufügen mehrerer Songs)",onlyNewItems:"Auf neue Elemente prüfen",onlyNewItemsDescription:"Nur auslösen, wenn es einen neuen Song gibt, der nicht im vorherigen Snapshot war.",equalQueuesNote:"Gleiche Warteschlangen werden nie als automatische Snapshots gespeichert.",queueWarnEnabled:"Warnen, wenn Warteschlange fast voll ist",queueWarnDescription:"Heuristische Grenze; beinhaltet aktuellen Track.",promptManualBeforeReplace:"Vor dem Ersetzen der Warteschlange nach manuellem Snapshot fragen",promptManualDescription:"Bietet an, die aktuelle Warteschlange zu speichern, bevor sie überschrieben wird.",interval:"Intervall (Minuten)",intervalDescription:"Minimum 0,5 (30 Sekunden)",maxAutomaticSnapshots:"Max. automatische Snapshots",maxAutomaticDescription:"Ältere Snapshots werden entfernt. Vorsicht beim Ändern",queueMaxSize:"Max. Warteschlangen-Größe",queueMaxSizeDescription:"80 ist das aktuelle Spotify-Limit. Nur ändern, wenn Spotify das aktualisiert.",queueWarnThreshold:"Warnen wenn verbleibende Plätze ≤",language:"Sprache",languageDescription:"Die automatisch erkannte Sprache überschreiben",autoDetected:"Automatisch erkannt"},toasts:{snapshotSaved:"Snapshot gespeichert",snapshotDeleted:"Snapshot gelöscht: {{name}}",clearedAutomaticSnapshots:"{{count}} automatische Snapshots gelöscht",exportedToPlaylist:"Als {{name}} exportiert",addedToQueue:"{{count}} {{plural}} zur Warteschlange hinzugefügt",queueReplaced:"Warteschlange ersetzt ({{count}} Elemente)",settingsImported:"Einstellungen erfolgreich importiert.",snapshotsImported:"{{count}} neue {{plural}} importiert.",noQueueFound:"Keine Warteschlange gefunden. Falls du glaubst, dass dies ein Fehler ist, versuche einen Track abzuspielen und zu pausieren.",nothingToExport:"Nichts zu exportieren",snapshotEmpty:"Snapshot ist leer",allItemsAlreadyInQueue:"Alle Snapshot-Elemente sind bereits in der Warteschlange",failedToSaveSnapshot:"Snapshot konnte nicht gespeichert werden",failedToExport:"Export zur Playlist fehlgeschlagen",failedToAppend:"Hinzufügen zur Warteschlange fehlgeschlagen",failedToReplace:"Ersetzen der Warteschlange fehlgeschlagen",failedToStartPlayback:"Wiedergabe konnte nicht gestartet werden",failedToSaveAutomatic:"Automatischer Snapshot konnte nicht gespeichert werden",failedToStartQueueWatcher:"Warteschlangen-Update-Überwacher konnte nicht gestartet werden",failedToStartCapacityWatcher:"Kapazitäts-Überwacher konnte nicht gestartet werden",queueNearlyFull:"Warteschlange fast voll ({{used}}/{{max}})",nameCannotBeEmpty:"Name darf nicht leer sein",nameMustDifferFromDefault:"Name muss sich vom Standard-Vorschlag unterscheiden",noAutomaticSnapshotsToClear:"Keine automatischen Snapshots zum Löschen",someImportedSnapshotsInvalid:"Einige importierte Snapshots waren ungültig und wurden übersprungen.",noValidSnapshotsToImport:"Keine gültigen Snapshots zum Importieren.",allSnapshotsAlreadyExist:"Alle Snapshots existieren bereits.",invalidSettingsFile:"Ungültiges Einstellungsdatei-Format.",exportResult:"Exportiert; einige Tracks konnten nicht hinzugefügt werden ({{added}}/{{total}})",appendResult:"{{added}}/{{total}} Elemente zur Warteschlange hinzugefügt",replaceResult:"Ersetzt; einige Elemente konnten nicht in die Warteschlange eingereiht werden ({{added}}/{{total}})",exportCanceled:"Export abgebrochen ({{reason}})",exportedToDownloads:"{{filename}} in den Downloads-Ordner exportiert",failedToExportJson:"JSON-Export fehlgeschlagen: {{reason}}",importCanceled:"Import abgebrochen ({{reason}})",failedToImportJson:"JSON-Import fehlgeschlagen: {{reason}}",failedToImportJsonAccess:"JSON-Import fehlgeschlagen: Datei ist leer oder nicht zugänglich",syncActivated:"Synchronisierungsmodus aktiviert",syncDeactivated:"Synchronisierungsmodus deaktiviert",queueSyncedToSnapshot:"Warteschlange mit Snapshot synchronisiert",syncedSnapshotCreated:"Synchronisierter Snapshot erstellt",failedToCreateSyncedSnapshot:"Erstellen des synchronisierten Snapshots fehlgeschlagen",failedToActivateSync:"Aktivieren des Synchronisierungsmodus fehlgeschlagen",failedToStartSyncManager:"Starten des Warteschlangen-Synchronisierungsmanagers fehlgeschlagen",queueRestored:"Warteschlange aus letztem Zustand wiederhergestellt",convertedToManual:"In manuellen Snapshot umgewandelt",syncedSnapshotNotFound:"Synchronisierter Snapshot existiert nicht mehr, Synchronisationsmodus deaktiviert"},dialogs:{saveSnapshot:{title:"Snapshot speichern",message:"Diesen Snapshot benennen",confirmLabel:"Speichern",cancelLabel:"Abbrechen"},deleteSnapshot:{title:"Snapshot löschen",message:"Diesen Snapshot löschen? Dies kann nicht rückgängig gemacht werden.",confirmLabel:"Löschen"},clearAutomaticSnapshots:{title:"Automatische Snapshots löschen",message:"Alle {{count}} automatischen Snapshots löschen? Dies kann nicht rückgängig gemacht werden.",confirmLabel:"Alle löschen"},saveCurrentQueue:{title:"Aktuelle Warteschlange speichern?",message:"Einen manuellen Snapshot der aktuellen Warteschlange erstellen, bevor sie ersetzt wird?",confirmLabel:"Snapshot speichern",cancelLabel:"Überspringen",extraLabel:"Abbrechen"},importSettings:{title:"Einstellungen importieren",message:"Dies wird deine aktuellen Einstellungen überschreiben. Bist du sicher?",confirmLabel:"Importieren"},saveSyncedSnapshot:{title:"Synchronisierten Snapshot erstellen",message:"Benenne diesen synchronisierten Snapshot. Dies wird deine aktuelle Warteschlange verwenden und den Synchronisierungsmodus automatisch aktivieren. Deine Warteschlange wird nicht geändert, es sei denn, du hast bereits einen aktiven Snapshot.",confirmLabel:"Erstellen",cancelLabel:"Abbrechen"},emptyQueueDetected:{title:"Leere Warteschlange erkannt",message:"Deine Warteschlange ist jetzt leer. Was möchtest du tun?",restore:"Vorherigen Zustand wiederherstellen",keepEmpty:"Leer lassen",switchSnapshot:"Snapshot wechseln"},convertToManual:{title:"In manuellen Snapshot umwandeln",message:"Diesen synchronisierten Snapshot in einen manuellen Snapshot umwandeln? Dies deaktiviert den Synchronisierungsmodus, falls aktiv.",confirmLabel:"Umwandeln"},switchSyncedSnapshot:{title:"Neuen synchronisierten Snapshot erstellen",message:"Das Erstellen eines neuen synchronisierten Snapshots speichert deine aktuelle Warteschlange und hält sie synchronisiert. Alle Änderungen an der Warteschlange werden automatisch in diesem Snapshot gespeichert. Möchtest du fortfahren?",confirmLabel:"Erstellen & synchronisieren",cancelLabel:"Abbrechen"}},errors:{failedToAddTopbarButton:"Topbar-Button konnte nicht hinzugefügt werden",failedToAddContextMenuItem:"Kontextmenü-Element konnte nicht hinzugefügt werden",failedToAddKeyboardShortcut:"Tastenkürzel konnte nicht hinzugefügt werden"}};var Ke={ui:{buttons:{save:"Guardar",cancel:"Cancelar",confirm:"Confirmar",delete:"Eliminar",export:"Exportar",import:"Importar",refresh:"Actualizar",view:"Ver",hide:"Ocultar",rename:"Renombrar",resetName:"Restablecer nombre",clearAll:"Limpiar todo",exportAll:"Exportar todo",saveNow:"Guardar ahora",replaceQueue:"Reemplazar cola",appendToQueue:"Añadir a la cola",exportToPlaylist:"Exportar a playlist",exportSettings:"Exportar configuración",importSnapshots:"Importar instantáneas",importSettings:"Importar configuración",createSyncedSnapshot:"Crear instantánea sincronizada",activateSync:"Activar sincronización",exitSyncMode:"Salir del modo sincronización",convertToManual:"Convertir a manual"},labels:{snapshotName:"Nombre de instantánea",toggleItems:"Alternar elementos",replaceQueue:"Reemplazar la cola actual",appendQueue:"Añadir elementos faltantes a la cola",exportToPlaylist:"Exportar a playlist",renameSnapshot:"Renombrar instantánea",resetName:"Restablecer nombre",deleteSnapshot:"Eliminar instantánea",exportSettings:"Exportar configuración a un archivo JSON",importSnapshots:"Importar instantáneas desde un archivo JSON",importSettings:"Importar configuración desde un archivo JSON",exportAllManuals:"Exportar todo",exportAllAutos:"Exportar todo",clearAllAutos:"Limpiar todo",saveNewManual:"Guardar ahora",activeSync:"Activa",syncModeDisabledActions:"Deshabilitado durante el modo sincronización",convertToManual:"Convertir instantánea sincronizada a manual"},sections:{manualSnapshots:"Instantáneas Manuales",manualSnapshotsCaption:"Tus colas guardadas para más tarde",automaticSnapshots:"Instantáneas Automáticas",automaticSnapshotsCaption:"Capturadas en segundo plano",syncedSnapshots:"Instantáneas sincronizadas",syncedSnapshotsCaption:"Instantáneas de cola que sincronizan en tiempo real",settings:"Configuración",settingsCaption:"Personaliza tu experiencia"},empty:{noManualSnapshots:"Aún no hay instantáneas manuales",noAutomaticSnapshots:"Aún no hay instantáneas automáticas",noSyncedSnapshots:"Aún no hay instantáneas sincronizadas",noSnapshots:"Aún no hay instantáneas"},itemSingular:"elemento",itemPlural:"elementos",includesLocal:"incluye archivos locales",loading:"Cargando…",failedToLoadItems:"No se pudieron cargar los elementos"},snapshots:{types:{auto:"Auto",manual:"Manual",synced:"Sincronizada"},defaults:{myJam:"Mi música"},actions:{exporting:"Exportando…",appending:"Añadiendo…",replacing:"Reemplazando…"}},settings:{autoEnabled:"Habilitar instantáneas automáticas",autoMode:"Modo",timeBased:"Basado en tiempo",queueChanges:"Cambios de cola",experimental:"¡Experimental!",experimentalTooltip:"Este modo puede crear muchas instantáneas similares (por ejemplo, al encolar varias canciones)",onlyNewItems:"Verificar elementos nuevos",onlyNewItemsDescription:"Solo se activa cuando hay una nueva canción que no estaba en la instantánea anterior.",equalQueuesNote:"Las colas iguales nunca se guardan como instantáneas automáticas.",queueWarnEnabled:"Advertir cuando la cola esté casi llena",queueWarnDescription:"Límite heurístico; incluye la pista actual.",promptManualBeforeReplace:"Preguntar para guardar instantánea manual antes de reemplazar cola",promptManualDescription:"Ofrece guardar la cola actual antes de sobrescribirla.",interval:"Intervalo (minutos)",intervalDescription:"Mínimo 0,5 (30 segundos)",maxAutomaticSnapshots:"Máx. instantáneas automáticas",maxAutomaticDescription:"Las instantáneas más antiguas se eliminan. Ten cuidado al cambiar esto",queueMaxSize:"Tamaño máximo de cola",queueMaxSizeDescription:"80 es el límite actual de Spotify. Solo cambiar si Spotify lo actualiza.",queueWarnThreshold:"Advertir cuando espacios restantes ≤",language:"Idioma",languageDescription:"Anular el idioma detectado automáticamente",autoDetected:"Detectado automáticamente"},toasts:{snapshotSaved:"Instantánea guardada",snapshotDeleted:"Instantánea eliminada: {{name}}",clearedAutomaticSnapshots:"{{count}} instantáneas automáticas eliminadas",exportedToPlaylist:"Exportado a {{name}}",addedToQueue:"{{count}} {{plural}} añadidos a la cola",queueReplaced:"Cola reemplazada ({{count}} elementos)",settingsImported:"Configuración importada exitosamente.",snapshotsImported:"{{count}} nuevas {{plural}} importadas.",noQueueFound:"No se encontró cola. Si crees que esto es un error, intenta reproducir y pausar una pista.",nothingToExport:"Nada que exportar",snapshotEmpty:"La instantánea está vacía",allItemsAlreadyInQueue:"Todos los elementos de la instantánea ya están en la cola",failedToSaveSnapshot:"No se pudo guardar la instantánea",failedToExport:"Falló la exportación a playlist",failedToAppend:"Falló al añadir a la cola",failedToReplace:"Falló al reemplazar la cola",failedToStartPlayback:"No se pudo iniciar la reproducción",failedToSaveAutomatic:"No se pudo guardar una instantánea automática",failedToStartQueueWatcher:"No se pudo iniciar el observador de actualización de cola",failedToStartCapacityWatcher:"No se pudo iniciar el observador de capacidad",queueNearlyFull:"Cola casi llena ({{used}}/{{max}})",nameCannotBeEmpty:"El nombre no puede estar vacío",nameMustDifferFromDefault:"El nombre debe diferir de la sugerencia por defecto",noAutomaticSnapshotsToClear:"No hay instantáneas automáticas para limpiar",someImportedSnapshotsInvalid:"Algunas instantáneas importadas eran inválidas y se han omitido.",noValidSnapshotsToImport:"No hay instantáneas válidas para importar.",allSnapshotsAlreadyExist:"Todas las instantáneas ya existen.",invalidSettingsFile:"Formato de archivo de configuración inválido.",exportResult:"Exportado; algunas pistas no se pudieron añadir ({{added}}/{{total}})",appendResult:"{{added}}/{{total}} elementos añadidos a la cola",replaceResult:"Reemplazado; algunos elementos no se pudieron encolar ({{added}}/{{total}})",exportCanceled:"Exportación cancelada ({{reason}})",exportedToDownloads:"{{filename}} exportado a la carpeta de Descargas",failedToExportJson:"Falló la exportación JSON: {{reason}}",importCanceled:"Importación cancelada ({{reason}})",failedToImportJson:"Falló la importación JSON: {{reason}}",failedToImportJsonAccess:"Falló la importación JSON: El archivo está vacío o no es accesible",syncActivated:"Modo sincronización activado",syncDeactivated:"Modo sincronización desactivado",queueSyncedToSnapshot:"Cola sincronizada con instantánea",syncedSnapshotCreated:"Instantánea sincronizada creada",failedToCreateSyncedSnapshot:"Error al crear instantánea sincronizada",failedToActivateSync:"Error al activar modo sincronización",failedToStartSyncManager:"Error al iniciar el gestor de sincronización de cola",queueRestored:"Cola restaurada desde el último estado",convertedToManual:"Convertida a instantánea manual",syncedSnapshotNotFound:"La instantánea sincronizada ya no existe, modo de sincronización desactivado"},dialogs:{saveSnapshot:{title:"Guardar instantánea",message:"Nombra esta instantánea",confirmLabel:"Guardar",cancelLabel:"Cancelar"},deleteSnapshot:{title:"Eliminar instantánea",message:"¿Eliminar esta instantánea? Esto no se puede deshacer.",confirmLabel:"Eliminar"},clearAutomaticSnapshots:{title:"Limpiar instantáneas automáticas",message:"¿Eliminar todas las {{count}} instantáneas automáticas? Esto no se puede deshacer.",confirmLabel:"Limpiar todo"},saveCurrentQueue:{title:"¿Guardar cola actual?",message:"¿Crear una instantánea manual de la cola actual antes de reemplazarla?",confirmLabel:"Guardar instantánea",cancelLabel:"Omitir",extraLabel:"Cancelar"},importSettings:{title:"Importar Configuración",message:"Esto sobrescribirá tu configuración actual. ¿Estás seguro?",confirmLabel:"Importar"},saveSyncedSnapshot:{title:"Crear instantánea sincronizada",message:"Nombra esta instantánea sincronizada. Esto usará los elementos de tu cola actual y la instantánea sincronizada se activará automáticamente.",confirmLabel:"Crear",cancelLabel:"Cancelar"},emptyQueueDetected:{title:"Cola vacía detectada",message:"Tu cola está ahora vacía. ¿Qué te gustaría hacer?",restore:"Restaurar estado anterior",keepEmpty:"Mantener vacía",switchSnapshot:"Cambiar instantánea"},convertToManual:{title:"Convertir a instantánea manual",message:"¿Convertir esta instantánea sincronizada a una instantánea manual? Esto desactivará el modo sincronización si está activo.",confirmLabel:"Convertir"},switchSyncedSnapshot:{title:"Crear nueva instantánea sincronizada",message:"Crear una nueva instantánea sincronizada guardará tu cola actual y la mantendrá sincronizada. Cualquier cambio en la cola se guardará automáticamente en esta instantánea. ¿Deseas continuar?",confirmLabel:"Crear y sincronizar",cancelLabel:"Cancelar"}},errors:{failedToAddTopbarButton:"no se pudo añadir botón de barra superior",failedToAddContextMenuItem:"no se pudo añadir elemento del menú contextual",failedToAddKeyboardShortcut:"no se pudo añadir atajo de teclado"}};var Ve={ui:{buttons:{save:"Enregistrer",cancel:"Annuler",confirm:"Confirmer",delete:"Supprimer",export:"Exporter",import:"Importer",refresh:"Actualiser",view:"Voir",hide:"Masquer",rename:"Renommer",resetName:"Réinitialiser le nom",clearAll:"Tout effacer",exportAll:"Tout exporter",saveNow:"Enregistrer maintenant",replaceQueue:"Remplacer la file",appendToQueue:"Ajouter à la file",exportToPlaylist:"Exporter vers playlist",exportSettings:"Exporter les paramètres",importSnapshots:"Importer les instantanés",importSettings:"Importer les paramètres",createSyncedSnapshot:"Créer un instantané synchronisé",activateSync:"Activer la synchronisation",exitSyncMode:"Quitter le mode synchronisation",convertToManual:"Convertir en manuel"},labels:{snapshotName:"Nom de l'instantané",toggleItems:"Basculer les éléments",replaceQueue:"Remplacer la file actuelle",appendQueue:"Ajouter les éléments manquants à la file",exportToPlaylist:"Exporter vers playlist",renameSnapshot:"Renommer l'instantané",resetName:"Réinitialiser le nom",deleteSnapshot:"Supprimer l'instantané",exportSettings:"Exporter les paramètres vers un fichier JSON",importSnapshots:"Importer les instantanés depuis un fichier JSON",importSettings:"Importer les paramètres depuis un fichier JSON",exportAllManuals:"Tout exporter",exportAllAutos:"Tout exporter",clearAllAutos:"Tout effacer",saveNewManual:"Enregistrer maintenant",activeSync:"Actif",syncModeDisabledActions:"Désactivé pendant le mode synchronisation",convertToManual:"Convertir l'instantané synchronisé en manuel"},sections:{manualSnapshots:"Instantanés Manuels",manualSnapshotsCaption:"Vos files sauvegardées pour plus tard",automaticSnapshots:"Instantanés Automatiques",automaticSnapshotsCaption:"Capturés en arrière-plan",syncedSnapshots:"Instantanés synchronisés",syncedSnapshotsCaption:"Instantanés de file d'attente synchronisés en temps réel",settings:"Paramètres",settingsCaption:"Personnalisez votre expérience"},empty:{noManualSnapshots:"Aucun instantané manuel pour le moment",noAutomaticSnapshots:"Aucun instantané automatique pour le moment",noSyncedSnapshots:"Aucun instantané synchronisé pour le moment",noSnapshots:"Aucun instantané pour le moment"},itemSingular:"élément",itemPlural:"éléments",includesLocal:"inclut des fichiers locaux",loading:"Chargement…",failedToLoadItems:"Impossible de charger les éléments"},snapshots:{types:{auto:"Auto",manual:"Manuel",synced:"Synchronisé"},defaults:{myJam:"Mon mix"},actions:{exporting:"Exportation…",appending:"Ajout…",replacing:"Remplacement…"}},settings:{autoEnabled:"Activer les instantanés automatiques",autoMode:"Mode",timeBased:"Basé sur le temps",queueChanges:"Changements de file",experimental:"Expérimental !",experimentalTooltip:"Ce mode peut créer de nombreux instantanés similaires (par exemple lors de l'ajout de plusieurs chansons)",onlyNewItems:"Vérifier les nouveaux éléments",onlyNewItemsDescription:"Ne se déclenche que lorsqu'il y a une nouvelle chanson qui n'était pas dans l'instantané précédent.",equalQueuesNote:"Les files identiques ne sont jamais sauvegardées comme instantanés automatiques.",queueWarnEnabled:"Avertir quand la file est presque pleine",queueWarnDescription:"Limite heuristique ; inclut la piste actuelle.",promptManualBeforeReplace:"Demander de sauvegarder un instantané manuel avant de remplacer la file",promptManualDescription:"Propose de sauvegarder la file actuelle avant de la remplacer.",interval:"Intervalle (minutes)",intervalDescription:"Minimum 0,5 (30 secondes)",maxAutomaticSnapshots:"Max instantanés automatiques",maxAutomaticDescription:"Les instantanés plus anciens sont supprimés. Attention lors du changement",queueMaxSize:"Taille max de la file",queueMaxSizeDescription:"80 est la limite actuelle de Spotify. Ne changer que si Spotify la met à jour.",queueWarnThreshold:"Avertir quand emplacements restants ≤",language:"Langue",languageDescription:"Remplacer la langue détectée automatiquement",autoDetected:"Détecté automatiquement"},toasts:{snapshotSaved:"Instantané enregistré",snapshotDeleted:"Instantané supprimé : {{name}}",clearedAutomaticSnapshots:"{{count}} instantanés automatiques effacés",exportedToPlaylist:"Exporté vers {{name}}",addedToQueue:"{{count}} {{plural}} ajoutés à la file",queueReplaced:"File remplacée ({{count}} éléments)",settingsImported:"Paramètres importés avec succès.",snapshotsImported:"{{count}} nouveaux {{plural}} importés.",noQueueFound:"Aucune file trouvée. Si vous pensez que c'est une erreur, essayez de lire et mettre en pause une piste.",nothingToExport:"Rien à exporter",snapshotEmpty:"L'instantané est vide",allItemsAlreadyInQueue:"Tous les éléments de l'instantané sont déjà dans la file",failedToSaveSnapshot:"Impossible de sauvegarder l'instantané",failedToExport:"Échec de l'exportation vers la playlist",failedToAppend:"Échec de l'ajout à la file",failedToReplace:"Échec du remplacement de la file",failedToStartPlayback:"Impossible de démarrer la lecture",failedToSaveAutomatic:"Impossible de sauvegarder un instantané automatique",failedToStartQueueWatcher:"Impossible de démarrer le surveilleur de mise à jour de file",failedToStartCapacityWatcher:"Impossible de démarrer le surveilleur de capacité",queueNearlyFull:"File presque pleine ({{used}}/{{max}})",nameCannotBeEmpty:"Le nom ne peut pas être vide",nameMustDifferFromDefault:"Le nom doit différer de la suggestion par défaut",noAutomaticSnapshotsToClear:"Aucun instantané automatique à effacer",someImportedSnapshotsInvalid:"Certains instantanés importés étaient invalides et ont été ignorés.",noValidSnapshotsToImport:"Aucun instantané valide à importer.",allSnapshotsAlreadyExist:"Tous les instantanés existent déjà.",invalidSettingsFile:"Format de fichier de paramètres invalide.",exportResult:"Exporté ; certaines pistes n'ont pas pu être ajoutées ({{added}}/{{total}})",appendResult:"{{added}}/{{total}} éléments ajoutés à la file",replaceResult:"Remplacé ; certains éléments n'ont pas pu être mis en file ({{added}}/{{total}})",exportCanceled:"Exportation annulée ({{reason}})",exportedToDownloads:"{{filename}} exporté vers le dossier Téléchargements",failedToExportJson:"Échec de l'exportation JSON : {{reason}}",importCanceled:"Importation annulée ({{reason}})",failedToImportJson:"Échec de l'importation JSON : {{reason}}",failedToImportJsonAccess:"Échec de l'importation JSON : Le fichier est vide ou inaccessible",syncActivated:"Mode synchronisation activé",syncDeactivated:"Mode synchronisation désactivé",queueSyncedToSnapshot:"File d'attente synchronisée avec l'instantané",syncedSnapshotCreated:"Instantané synchronisé créé",failedToCreateSyncedSnapshot:"Échec de la création de l'instantané synchronisé",failedToActivateSync:"Échec de l'activation du mode synchronisation",failedToStartSyncManager:"Échec du démarrage du gestionnaire de synchronisation de file d'attente",queueRestored:"File d'attente restaurée depuis le dernier état",convertedToManual:"Converti en instantané manuel",syncedSnapshotNotFound:"L'instantané synchronisé n'existe plus, mode de synchronisation désactivé"},dialogs:{saveSnapshot:{title:"Enregistrer l'instantané",message:"Nommer cet instantané",confirmLabel:"Enregistrer",cancelLabel:"Annuler"},deleteSnapshot:{title:"Supprimer l'instantané",message:"Supprimer cet instantané ? Cette action ne peut pas être annulée.",confirmLabel:"Supprimer"},clearAutomaticSnapshots:{title:"Effacer les instantanés automatiques",message:"Supprimer tous les {{count}} instantanés automatiques ? Cette action ne peut pas être annulée.",confirmLabel:"Tout effacer"},saveCurrentQueue:{title:"Enregistrer la file actuelle ?",message:"Créer un instantané manuel de la file actuelle avant de la remplacer ?",confirmLabel:"Enregistrer l'instantané",cancelLabel:"Ignorer",extraLabel:"Annuler"},importSettings:{title:"Importer les Paramètres",message:"Cela remplacera vos paramètres actuels. Êtes-vous sûr ?",confirmLabel:"Importer"},saveSyncedSnapshot:{title:"Créer un instantané synchronisé",message:"Nomme cet instantané synchronisé. Cela utilisera les éléments de ta file d'attente actuelle et l'instantané synchronisé sera activé automatiquement.",confirmLabel:"Créer",cancelLabel:"Annuler"},emptyQueueDetected:{title:"File d'attente vide détectée",message:"Ta file d'attente est maintenant vide. Que souhaites-tu faire ?",restore:"Restaurer l'état précédent",keepEmpty:"Garder vide",switchSnapshot:"Changer d'instantané"},convertToManual:{title:"Convertir en instantané manuel",message:"Convertir cet instantané synchronisé en instantané manuel ? Cela désactivera le mode synchronisation s'il est actif.",confirmLabel:"Convertir"},switchSyncedSnapshot:{title:"Créer un nouvel instantané synchronisé",message:"Créer un nouvel instantané synchronisé sauvegardera ta file d'attente actuelle et la gardera synchronisée. Tous les changements à la file d'attente seront automatiquement sauvegardés dans cet instantané. Veux-tu continuer ?",confirmLabel:"Créer & synchroniser",cancelLabel:"Annuler"}},errors:{failedToAddTopbarButton:"impossible d'ajouter le bouton de barre supérieure",failedToAddContextMenuItem:"impossible d'ajouter l'élément du menu contextuel",failedToAddKeyboardShortcut:"impossible d'ajouter le raccourci clavier"}};var Qe=["en","de","es","fr"];function Ye(){try{let e=Q();if(e.language&&Qe.includes(e.language))return e.language;let n=Spicetify?.Platform?.Session?.locale;if(Qe.includes(n))return n}catch{}return"en"}var hn={en:Fe,de:Ie,es:Ke,fr:Ve},Se=Ye();function a(e,n){let i=xn(hn[Se],e);if(typeof i!=="string")return console.warn(`${g}: translation missing for key: ${e} in locale: ${Se}`),String(e);if(!n)return i;return i.replace(/\{\{(\w+)\}\}/g,(t,l)=>{return String(n[l]||t)})}function xn(e,n){return n.split(".").reduce((i,t)=>i?.[t],e)}function ve(){Se=Ye()}ve();var N=null,Z=new Map;function Ce(e){return Number.isFinite(e)&&e>0}function gn(e){let n=e.querySelector(".qs-toast-progress")??null,i=n?.querySelector(".qs-toast-progress__bar")??null;if(!n)n=document.createElement("div"),n.className="qs-toast-progress qs-toast-progress--hidden",n.setAttribute("aria-hidden","true");else if(!n.classList.contains("qs-toast-progress--hidden")&&!n.classList.contains("qs-toast-progress--visible"))n.classList.add("qs-toast-progress--hidden");if(!i)i=document.createElement("div"),i.className="qs-toast-progress__bar",i.style.transform="scaleX(0)",n.appendChild(i);else if(i.parentElement!==n)n.appendChild(i);if(n.parentElement!==e)e.appendChild(n);else if(n.nextSibling)e.appendChild(n);return{track:n,bar:i}}function Xe(e){let{track:n,bar:i}=gn(e),t=Z.get(e);if(!t){let l=performance.now();t={timeoutId:void 0,rafId:void 0,startTime:l,endTime:l,remaining:1/0,totalDuration:1/0,progressTrack:n,progressBar:i},Z.set(e,t)}else t.progressTrack=n,t.progressBar=i;return t}function ae(e,n){let i=Z.get(e);if(!i||!i.progressTrack||!i.progressBar)i=Xe(e);if(!i.progressTrack||!i.progressBar)return;if(n===null||Number.isNaN(n)||n<0){i.progressTrack.classList.remove("qs-toast-progress--visible"),i.progressTrack.classList.add("qs-toast-progress--hidden"),i.progressBar.style.transform="scaleX(0)";return}let t=Math.min(1,Math.max(0,n));i.progressTrack.classList.remove("qs-toast-progress--hidden"),i.progressTrack.classList.add("qs-toast-progress--visible"),i.progressBar.style.transform=`scaleX(${t})`}function Ue(e){let n=Z.get(e);if(!n)return;if(!Ce(n.totalDuration)){ae(e,null),n.rafId=void 0;return}let i=performance.now(),t=Math.max(0,n.endTime-i);n.remaining=t;let l=n.totalDuration<=0?1:1-t/n.totalDuration;if(ae(e,l),t>0)n.rafId=window.requestAnimationFrame(()=>Ue(e));else n.rafId=void 0}function Me(e){let n=Z.get(e);if(n&&Ce(n.remaining)){if(n.remaining<=0){_(e);return}ue(e,n.remaining,!1);return}let i=bn(e);if(i&&Ce(i))ue(e,i);else ae(e,null)}function $e(e){if(typeof e!=="string")return e;let n=e.trim();if(!n.length)throw Error(`${g} toast message cannot be empty`);return n}function Ze(e,n){while(e.firstChild)e.removeChild(e.firstChild);if(typeof n==="string")e.textContent=n;else e.appendChild(n)}function yn(){if(N&&document.body.contains(N))return N;return N=document.createElement("div"),N.className="qs-toast-container",N.setAttribute("role","region"),N.setAttribute("aria-live","polite"),N.setAttribute("aria-label","Notifications"),document.body.appendChild(N),N}function Ge(e,n){if(n>0&&isFinite(n))e.dataset.toastDuration=String(n);else delete e.dataset.toastDuration}function bn(e){let n=e.dataset.toastDuration;if(!n)return null;let i=Number(n);return Number.isFinite(i)&&i>0?i:null}function ue(e,n,i=!0){let t=Xe(e);if(fe(e),n<=0||!isFinite(n)){t.remaining=1/0,t.endTime=1/0,ae(e,null);return}let l=performance.now();if(t.startTime=l,t.endTime=l+n,t.remaining=n,i)t.totalDuration=n;ae(e,t.totalDuration<=0?1:1-t.remaining/t.totalDuration),t.timeoutId=window.setTimeout(()=>{_(e)},n),t.rafId=window.requestAnimationFrame(()=>Ue(e))}function fe(e){let n=Z.get(e);if(!n)return;if(typeof n.timeoutId==="number")clearTimeout(n.timeoutId),n.timeoutId=void 0;if(typeof n.rafId==="number")cancelAnimationFrame(n.rafId),n.rafId=void 0}function qn(){if(!N)return;if(!N.childElementCount)N.remove(),N=null}function _(e,n="default"){fe(e),Z.delete(e),e.classList.remove("qs-toast--enter","qs-toast--swipe-exit"),e.classList.add(n==="swipe"?"qs-toast--swipe-exit":"qs-toast--exit");let i,t=()=>{if(e.removeEventListener("transitionend",t),e.removeEventListener("animationend",t),i!==void 0)window.clearTimeout(i);e.remove(),qn()};e.addEventListener("transitionend",t),e.addEventListener("animationend",t),i=window.setTimeout(t,450),e.setAttribute("aria-hidden","true")}function ze(e,n={}){let{tone:i="default",duration:t=3600,dismissible:l,id:c}=n,p=yn();if(c){let C=Array.from(p.children).find((L)=>L instanceof HTMLElement&&L.dataset.toastId===c);if(C){C.classList.remove("qs-toast--exit"),C.dataset.toastId=c;let L=C.querySelector(".qs-toast-message");if(L){let B=$e(e);Ze(L,B)}return Ge(C,t),ue(C,t),{close:()=>_(C),element:C}}}let o=document.createElement("div");if(o.className=`qs-toast qs-toast--${i}`,o.setAttribute("role","status"),o.setAttribute("aria-live",i==="danger"?"assertive":"polite"),c)o.dataset.toastId=c;let f=document.createElement("div");f.className="qs-toast-content";let r=document.createElement("div");r.className="qs-toast-title",r.textContent=g;let m=document.createElement("div");m.className="qs-toast-message";let s=$e(e);Ze(m,s);let h=document.createElement("button");if(h.type="button",h.className="qs-toast-close",h.setAttribute("aria-label",a("ui.buttons.cancel")),h.innerHTML="&times;",h.addEventListener("click",(C)=>{C.preventDefault(),_(o)}),!(l??!(t>0&&isFinite(t)))&&t>0&&isFinite(t))h.classList.add("qs-toast-close--hidden");f.appendChild(r),f.appendChild(m),o.appendChild(f),o.appendChild(h),p.appendChild(o),o.offsetWidth,o.classList.add("qs-toast--enter"),Ge(o,t),ue(o,t),o.addEventListener("mouseenter",()=>{fe(o);let C=Z.get(o);if(C&&Number.isFinite(C.remaining)){let L=performance.now();C.remaining=Math.max(0,C.endTime-L)}}),o.addEventListener("mouseleave",()=>{Me(o)});let u=0,x=0,S=!1,v=80,y=(C)=>{if(!S)return;x=C;let L=x-u;if(L<0){let B=Math.max(L,-200);o.style.transform=`translateX(${B}px)`,o.style.opacity=String(Math.max(0,1-Math.abs(B)/160))}else o.style.transform="translateX(0px)",o.style.opacity="1"},q=(C)=>{if(S=!1,o.classList.remove("qs-toast--dragging"),o.style.removeProperty("transition"),o.style.removeProperty("transform"),o.style.removeProperty("opacity"),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",F),document.removeEventListener("touchend",H),document.removeEventListener("touchcancel",ce),C)_(o,"swipe");else o.classList.add("qs-toast--enter"),Me(o)},w=()=>{if(S)q(!1)},T=(C)=>{if(y(C.clientX),!S)return;C.preventDefault()},b=(C)=>{if(!S)return;let L=C.clientX-u;q(L<=-v)},F=(C)=>{if(!S)return;let L=C.touches[0];if(!L)return;y(L.clientX),C.preventDefault()},H=(C)=>{if(!S)return;let L=C.changedTouches[0];if(!L){q(!1);return}let B=L.clientX-u;q(B<=-v)},ce=()=>{if(S)q(!1)},be=(C)=>{S=!0,u=C,x=C,o.classList.add("qs-toast--dragging"),fe(o),o.style.transition="none"};return o.addEventListener("mousedown",(C)=>{if(C.button!==0)return;be(C.clientX),document.addEventListener("mousemove",T),document.addEventListener("mouseup",b),window.addEventListener("blur",w,{once:!0})}),o.addEventListener("touchstart",(C)=>{let L=C.touches[0];if(!L)return;be(L.clientX),document.addEventListener("touchmove",F,{passive:!1}),document.addEventListener("touchend",H),document.addEventListener("touchcancel",ce),window.addEventListener("blur",w,{once:!0})}),{close:()=>_(o),element:o}}function z(e,n={}){return ze(e,{tone:"danger",...n})}function A(e,n={}){return ze(e,{tone:"success",...n})}function I(e,n={}){return ze(e,{tone:"warning",...n})}var Sn=16;function He(e){try{return new Date(e).toLocaleString()}catch{return`${e}`}}function Y(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function D(e,n=Sn){let t=(Spicetify.SVGIcons??{})[e];if(!t)return"";return`<span class="qs-btn-icon" data-icon-name="${Y(e)}"><svg class="qs-svg-icon" viewBox="0 0 16 16" aria-hidden="true" focusable="false" style="width:${n}px;height:${n}px;">${t}</svg></span>`}function V(e,n){let i=e.querySelector(".qs-btn-label");if(i)i.textContent=n;else e.textContent=n}function Te(e,n){let i=e.querySelector(".qs-btn-icon");if(i){let t=D(n);if(t)i.outerHTML=t}}function P(){return`${Date.now()}-${Math.random().toString(36).slice(2,8)}`}function G(e,n){if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}async function he(e,n){try{let i=JSON.stringify(n,null,2),t=new Blob([i],{type:"application/json"});if(typeof window?.showSaveFilePicker==="function")try{let o=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]})).createWritable();await o.write(t),await o.close();return}catch(p){let o=p instanceof Error,f=o?p.name:"Unknown",r=o?p.message:"",m=f==="AbortError"&&(r.includes("Failed to create")||r.includes("Failed to truncate")||r.includes("permission")||r.includes("access")||r.includes("denied"));if(f==="AbortError"&&!m)return;let s=o?`${f}: ${r}`:"Unknown error";z(a("toasts.failedToExportJson",{reason:s}),{duration:1e4});return}let l=URL.createObjectURL(t),c=document.createElement("a");c.href=l,c.download=e,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(l),A(a("toasts.exportedToDownloads",{filename:e}))}catch(i){console.warn(`${g}: downloadJson failed`,i);let l=i instanceof Error?`${i.name}: ${i.message}`:"Unknown error";z(a("toasts.failedToExportJson",{reason:l}),{duration:1e4})}}async function we(){try{let e;if(typeof window?.showOpenFilePicker==="function")try{let[i]=await window.showOpenFilePicker({multiple:!1,types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]});e=await(await i.getFile()).text()}catch(i){let t=i instanceof Error;if((t?i.name:"Unknown")==="AbortError")return null;let c=t?`${i.name}: ${i.message}`:"Unknown error";return z(a("toasts.failedToImportJson",{reason:c}),{duration:1e4}),null}else{let i=document.createElement("input");i.type="file",i.accept=".json,application/json";let t=await new Promise((l)=>{i.onchange=async()=>{if(i.files?.length)try{let c=i.files[0];if(c.size===0){z(a("toasts.failedToImportJsonAccess"),{duration:1e4}),l(null);return}let p=await c.text();if(p.length===0){z(a("toasts.failedToImportJsonAccess"),{duration:1e4}),l(null);return}l(p)}catch(c){console.error(`${g}: file read failed`,c);let o=c instanceof Error?`${c.name}: ${c.message}`:"Unknown error";z(a("toasts.failedToImportJson",{reason:o}),{duration:1e4}),l(null)}else l(null)},i.click()});if(t)e=t}if(typeof e!=="string")return null;return JSON.parse(e)}catch(e){console.warn(`${g}: uploadJson failed`,e);let i=e instanceof Error?`${e.name}: ${e.message}`:"Unknown error";return z(a("toasts.failedToImportJson",{reason:i}),{duration:1e4}),null}}function vn(e){let n=e.split(":"),i=n[2]||"Local",t=n[4]||"track";try{let l=decodeURIComponent(i.replace(/\+/g," ")),c=decodeURIComponent(t.replace(/\+/g," "));return`${l} - ${c}`}catch{return`${i} - ${t}`}}async function Cn(e){let n=Array(e.length).fill(""),i=[],t=[];if(e.forEach((l,c)=>{if(l.startsWith("spotify:local:")){n[c]=vn(l);return}let p=Spicetify.URI.from(l);if(!p||!p.id){n[c]=l;return}if(p.type==="track")i.push({idx:c,id:p.id,uri:p});else if(p.type==="episode")t.push({idx:c,id:p.id,uri:p});else n[c]=l}),i.length){let l=i.map(async(p)=>{let o=Spicetify.URI.idToHex(p.id),r=(await Spicetify.Platform.RequestBuilder.build().withHost("https://spclient.wg.spotify.com/metadata/4").withPath(`/${p.uri.type}/${o}`).send()).body,m=r?.name,s=r?.artist||[],h=Array.isArray(s)?s.map((u)=>u?.name).filter(Boolean).join(", "):"",d=m?h?`${h} - ${m}`:m:null;return{idx:p.idx,id:p.id,display:d}});(await Promise.allSettled(l)).forEach((p,o)=>{let{idx:f}=i[o];if(p.status==="fulfilled"){let r=p.value;n[r.idx]=r.display||e[r.idx]}else n[f]=e[f]})}if(t.length){let l=t.map(async(p)=>{let o=e[p.idx],f=await Spicetify.Platform.ShowAPI.getEpisodeOrChapter(o),r=f?.name,m=f?.podcast?.name,s=r?m?`${m} - ${r}`:r:null;return{idx:p.idx,id:p.id,display:s}});(await Promise.allSettled(l)).forEach((p,o)=>{let{idx:f}=t[o];if(p.status==="fulfilled"){let r=p.value;n[r.idx]=r.display||e[r.idx]}else n[f]=e[f]})}return n}var Be=new Map;async function _e(e){let n=Be.get(e.id);if(n)return n;let i=await Cn(e.items);return Be.set(e.id,i),i}function E(e){if(e.type==="synced")return a("snapshots.defaults.myJam");return`${e.type==="auto"?a("snapshots.types.auto"):a("snapshots.types.manual")} ${He(e.createdAt)}`}function ie(e){return e.name||E(e)}function De(e){if(typeof e==="string"&&e.startsWith("spotify:"))return e;if(e&&typeof e.uri==="string"&&e.uri.startsWith("spotify:"))return e.uri;if(e&&e.contextTrack&&typeof e.contextTrack.uri==="string"&&e.contextTrack.uri.startsWith("spotify:"))return e.contextTrack.uri;if(e&&e.track&&typeof e.track.uri==="string"&&e.track.uri.startsWith("spotify:"))return e.track.uri;if(e&&e.item&&typeof e.item.uri==="string"&&e.item.uri.startsWith("spotify:"))return e.item.uri;return null}function zn(e){let n=[],i=null;for(let t of e){if(t&&t!==i)n.push(t);i=t}return n}function R(){try{let e=Spicetify.Queue,n=[],i=De(e?.track)||De(Spicetify.Player?.data?.item);if(i)n.push(i);let t=e?.nextTracks||[];for(let c of Array.isArray(t)?t:[]){let p=c?.provider,o=c?.contextTrack?.metadata||c?.metadata,f=o?.is_queued===!0||o?.is_queued==="true";if(!(p==="queue"||f))continue;let m=De(c);if(m)n.push(m)}return n.length?zn(n):[]}catch(e){return console.error(`${g}: Spicetify.Queue read failed`,e),[]}}var ee=!1;function Le(e){return e==="danger"||e==="primary"||e==="subtle"?e:"default"}function Pe(){let e=document.createElement("div");return e.className="qs-confirm-backdrop",document.body.appendChild(e),e}function Ee(e){let n=document.createElement("div");return n.className="qs-confirm-dialog",e.appendChild(n),n}function K(e){if(ee)return Promise.resolve("cancel");ee=!0;let{title:n,message:i,confirmLabel:t=a("ui.buttons.confirm"),cancelLabel:l=a("ui.buttons.cancel"),tone:c="default",extraLabel:p,extraTone:o="subtle"}=e;return new Promise((f)=>{let r=Pe(),m=Ee(r);if(n){let b=document.createElement("div");b.className="qs-confirm-title",b.textContent=n,m.appendChild(b)}let s=document.createElement("div");s.className="qs-confirm-message",s.textContent=i,m.appendChild(s);let h=document.createElement("div");h.className="qs-confirm-actions";let d=document.createElement("button");d.type="button",d.className="qs-btn subtle",d.textContent=l;let u=document.createElement("button");u.type="button";let x=Le(c),S=["qs-btn"];if(x!=="default")S.push(x);else S.push("primary");u.className=S.join(" "),u.textContent=t;let v=null;if(p){v=document.createElement("button"),v.type="button";let b=Le(o),F=["qs-btn"];if(b!=="default")F.push(b);else F.push("primary");v.className=F.join(" "),v.textContent=p}if(v)h.append(d,v,u);else h.append(d,u);m.appendChild(h);let y=document.activeElement,q=!1;function w(b){if(q)return;if(q=!0,r.remove(),y?.focus)y.focus();document.removeEventListener("keydown",T,!0),ee=!1,f(b)}function T(b){if(b.key==="Escape")b.preventDefault(),w("cancel");else if(b.key==="Enter"&&document.activeElement===u)b.preventDefault(),w("confirm")}if(d.addEventListener("click",()=>w("cancel")),u.addEventListener("click",()=>w("confirm")),v)v.addEventListener("click",()=>w("extra"));r.addEventListener("click",(b)=>{if(b.target===r)w("cancel")}),document.addEventListener("keydown",T,!0),setTimeout(()=>{u.focus()},0)})}function xe(e){if(ee)return Promise.resolve(null);ee=!0;let{title:n,message:i,confirmLabel:t=a("ui.buttons.confirm"),cancelLabel:l=a("ui.buttons.cancel"),tone:c="default",defaultValue:p="",placeholder:o}=e;return new Promise((f)=>{let r=Pe(),m=Ee(r);if(n){let b=document.createElement("div");b.className="qs-confirm-title",b.textContent=n,m.appendChild(b)}if(i){let b=document.createElement("div");b.className="qs-confirm-message",b.textContent=i,m.appendChild(b)}let s=document.createElement("input");if(s.type="text",s.className="qs-dialog-input",s.value=p,o)s.placeholder=o;m.appendChild(s);let h=document.createElement("div");h.className="qs-confirm-actions";let d=document.createElement("button");d.type="button",d.className="qs-btn subtle",d.textContent=l;let u=document.createElement("button");u.type="button";let x=Le(c),S=["qs-btn"];if(x!=="default")S.push(x);else S.push("primary");u.className=S.join(" "),u.textContent=t,h.append(d,u),m.appendChild(h);let v=document.activeElement,y=!1;function q(b){if(y)return;if(y=!0,r.remove(),s.removeEventListener("keydown",w),document.removeEventListener("keydown",T,!0),v?.focus)v.focus();ee=!1,f(b)}function w(b){if(b.key==="Enter")b.preventDefault(),q(s.value);else if(b.key==="Escape")b.preventDefault(),q(null)}function T(b){if(b.key==="Escape")b.preventDefault(),q(null)}d.addEventListener("click",()=>q(null)),u.addEventListener("click",()=>q(s.value)),s.addEventListener("keydown",w),document.addEventListener("keydown",T,!0),r.addEventListener("click",(b)=>{if(b.target===r)q(null)}),setTimeout(()=>{s.focus(),s.select()},0)})}async function te(){try{let e=R();if(!e.length){I(a("toasts.noQueueFound"));return}let n=E({type:"manual",createdAt:Date.now()}),i=(await xe({title:a("dialogs.saveSnapshot.title"),message:a("dialogs.saveSnapshot.message"),confirmLabel:a("dialogs.saveSnapshot.confirmLabel"),cancelLabel:a("dialogs.saveSnapshot.cancelLabel"),defaultValue:n}))?.trim()??null;if(i===null)return;else if(i===""){z(a("toasts.nameCannotBeEmpty"));return}let t={id:P(),createdAt:Date.now(),name:i===n?void 0:i,type:"manual",items:e,playbackPosition:Spicetify.Player.getProgress()};de(t),A(a("toasts.snapshotSaved"))}catch(e){console.error(`${g}: manual snapshot failed`,e),z(a("toasts.failedToSaveSnapshot"))}}async function en(e,n){try{if(!e.items.length){I(a("toasts.nothingToExport"));return}if(n)n.disabled=!0,V(n,a("snapshots.actions.exporting"));let t=(await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/me"))?.id;if(!t)throw Error("No user id");let l=ie(e),p=(await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/users/${encodeURIComponent(t)}/playlists`,{name:l,description:`Saved from ${g} on ${new Date(e.createdAt).toLocaleString()}`,public:!1}))?.id;if(!p)throw Error("Playlist creation failed");let o=`spotify:playlist:${p}`,f=0,r=e.items.length;for(let s=0;s<e.items.length;s+=100){let h=e.items.slice(s,s+100);try{await Spicetify.Platform.PlaylistAPI.add(o,h,{after:"end"}),f+=h.length}catch(d){console.warn(`${g}: failed to add a chunk`,d)}}if(f===r){A(a("toasts.exportedToPlaylist",{name:l}));try{let h=Spicetify.URI.playlistV2URI(p)?.toURLPath(!0),d=Spicetify.Platform.History;if(h)if(d?.push)try{d.push(h)}catch{d.push({pathname:h})}else window.location.hash=h}catch{}}else I(a("toasts.exportResult",{added:f,total:r}));try{console.log(`${g}: Export result`,{snapshotId:e.id,totalExpected:r,totalAdded:f})}catch{}}catch(i){console.error(`${g}: export failed`,i),z(a("toasts.failedToExport"))}finally{if(n)n.disabled=!1,V(n,a("ui.buttons.export"))}}async function nn(e,n){try{if(!e.items.length){I(a("toasts.snapshotEmpty"));return}if(n)n.disabled=!0,V(n,a("snapshots.actions.appending"));let i=R(),t=new Set(i),l=e.items.filter((o)=>!t.has(o));if(!l.length){I(a("toasts.allItemsAlreadyInQueue"));return}let c=0;for(let o=0;o<l.length;o+=100){let f=l.slice(o,o+100),r=f.map((m)=>({uri:m}));try{await Spicetify.Platform.PlayerAPI.addToQueue(r),c+=r.length}catch(m){console.warn(`${g}: addToQueue chunk failed`,m);for(let s of f)try{await Spicetify.Platform.PlayerAPI.addToQueue([{uri:s}]),c+=1}catch(h){console.warn(`${g}: addToQueue single failed`,{uri:s,error:h})}}}let p=l.length;if(c===p)A(a("toasts.addedToQueue",{count:p,plural:p===1?a("ui.itemSingular"):a("ui.itemPlural")}));else if(c>0)I(a("toasts.appendResult",{added:c,total:p}));else z(a("toasts.failedToAppend"));try{console.log(`${g}: Append result`,{snapshotId:e.id,totalExpected:p,added:c})}catch{}}catch(i){console.error(`${g}: append queue failed`,i),z(a("toasts.failedToAppend"))}finally{if(n)n.disabled=!1,V(n,a("ui.buttons.appendToQueue"))}}async function ge(e,n,i){try{if(!e.items.length){I(a("toasts.snapshotEmpty"));return}let t=R();if(G(t,e.items))return;let l=Q();if(l.promptManualBeforeReplace&&!l.syncedSnapshotId&&e.type==="synced"){let r=await K({title:a("dialogs.saveCurrentQueue.title"),message:a("dialogs.saveCurrentQueue.message"),confirmLabel:a("dialogs.saveCurrentQueue.confirmLabel"),cancelLabel:a("dialogs.saveCurrentQueue.cancelLabel"),extraLabel:a("dialogs.saveCurrentQueue.extraLabel"),extraTone:"danger",tone:"primary"});if(r==="extra")return;if(r==="confirm")await te()}if(n)n.disabled=!0,V(n,a("snapshots.actions.replacing"));let c=i?.getSyncManager();if(c)c.suspend();let p=e.items.slice(),o=p.shift();try{await Spicetify.Platform.PlayerAPI.clearQueue()}catch(r){console.warn(`${g}: clearQueue failed (non-fatal)`,r)}if(await new Promise((r)=>setTimeout(r,100)),o.startsWith("spotify:local:"))try{await Spicetify.Platform.PlayerAPI.play({uri:"spotify:internal:local-files",pages:[{items:[{uri:o}]}]},{},{skipTo:{index:0}})}catch(r){console.warn(`${g}: local fallback failed`,r),z(a("toasts.failedToStartPlayback"));return}else try{await Spicetify.Player.playUri(o)}catch(r){try{await Spicetify.Platform.PlayerAPI.play({uri:o},{},{})}catch(m){console.warn(`${g}: failed to start first track`,m),z(a("toasts.failedToStartPlayback"));return}}if(await new Promise((r)=>setTimeout(r,250)),e.playbackPosition!==void 0&&e.playbackPosition>0)try{await Spicetify.Platform.PlayerAPI.seekTo(e.playbackPosition),console.log(`${g}: seeked to saved position ${e.playbackPosition}ms`)}catch(r){console.warn(`${g}: failed to seek to saved position ${e.playbackPosition}ms`,r);try{await Spicetify.Player.seek(e.playbackPosition),console.log(`${g}: seeked using fallback API to ${e.playbackPosition}ms`)}catch(m){console.error(`${g}: both seek methods failed`,m)}}let f=0;for(let r=0;r<p.length;r+=100){let m=p.slice(r,r+100).map((s)=>({uri:s}));try{await Spicetify.Platform.PlayerAPI.addToQueue(m),f+=m.length}catch(s){console.warn(`${g}: addToQueue chunk failed`,s)}}if(f===p.length)A(a("toasts.queueReplaced",{count:e.items.length}));else I(a("toasts.replaceResult",{added:f+1,total:e.items.length}))}catch(t){console.error(`${g}: replace queue failed`,t),z(a("toasts.failedToReplace"))}finally{if(i?.getSyncManager())await i.getSyncManager().resume();if(n)n.disabled=!1,V(n,a("ui.buttons.replaceQueue"))}}function Tn(e){return e&&typeof e.id==="string"&&typeof e.createdAt==="number"&&(e.type==="auto"||e.type==="manual"||e.type==="synced")&&Array.isArray(e.items)&&e.items.every((n)=>typeof n==="string")}function wn(e){return e&&typeof e.autoEnabled==="boolean"&&typeof e.autoIntervalMs==="number"&&typeof e.maxAutosnapshots==="number"&&(e.autoMode==="timer"||e.autoMode==="on-change")&&typeof e.onlyNewItems==="boolean"&&typeof e.queueWarnEnabled==="boolean"&&typeof e.queueMaxSize==="number"&&typeof e.queueWarnThreshold==="number"&&typeof e.promptManualBeforeReplace==="boolean"}async function an(){let e=await we();if(!e)return;let n=Array.isArray(e)?e:[e],i=n.filter(Tn);if(i.length!==n.length)z(a("toasts.someImportedSnapshotsInvalid"));if(!i.length){z(a("toasts.noValidSnapshotsToImport"));return}let t=k(),l=new Set(t.map((o)=>o.id)),c=i.filter((o)=>!l.has(o.id));if(!c.length){A(a("toasts.allSnapshotsAlreadyExist"));return}let p=[...t,...c];j(p),W(),A(a("toasts.snapshotsImported",{count:c.length,plural:c.length===1?"snapshot":"snapshots"}))}async function tn(e){let n=await we();if(!n)return;if(!wn(n)){z(a("toasts.invalidSettingsFile"));return}if(await K({title:a("dialogs.importSettings.title"),message:a("dialogs.importSettings.message"),confirmLabel:a("dialogs.importSettings.confirmLabel"),tone:"danger"})!=="confirm")return;e.setSettings(n),M(e),A(a("toasts.settingsImported"))}var oe=null,re=null,O=new Set,X=new Map;function le(e){let n=e.getSettings(),i=!!n.syncedSnapshotId,t=n.autoEnabled&&!i,l=document.querySelector("#qs-auto-enabled"),c=document.querySelectorAll('input.qs-radio[name="qs-auto-mode"]'),p=document.querySelector("#qs-auto-interval-mins"),o=document.querySelector("#qs-only-new"),f=document.querySelector("#qs-max-autos"),r=document.querySelector("#qs-queue-max-size"),m=document.querySelector("#qs-queue-warn-threshold");if(l)l.disabled=i;if(c.forEach((h)=>{h.disabled=!t}),p)p.disabled=!(t&&n.autoMode==="timer");if(o)o.disabled=!t;if(f)f.disabled=!t;let s=n.queueWarnEnabled;if(r)r.disabled=!s;if(m)m.disabled=!s}function se(e){Array.from(X.keys()).forEach((n)=>{if(n!==e)rn(n)})}function rn(e){let n=X.get(e);if(!n)return;if(n.input.removeEventListener("keydown",n.onKeyDown),n.input.removeEventListener("blur",n.onBlur),n.input.isConnected)n.input.remove();if(n.labelEl.style.display="",n.labelEl.textContent=n.originalLabel,n.actionsEl)n.actionsEl.style.display=n.originalActionsDisplay??"";X.delete(e)}function ln(e,n,i){if(!e.isConnected)return;let t=n.id;if(X.has(t)){let d=X.get(t);if(d)d.input.focus(),d.input.select();return}let l=e.querySelector(".qs-row-title");if(!l)return;let c=Array.from(l.querySelectorAll("span"))[1];if(!c)return;let p=l.querySelector(".qs-title-actions")??void 0,o=c.textContent??"",f=E(n),r=p?.style.display??"",m=document.createElement("input");if(m.type="text",m.value=n.name??o,m.className="qs-inline-input",m.setAttribute("aria-label",a("ui.labels.snapshotName")),c.style.display="none",p)p.style.display="none";l.insertBefore(m,p??null);let s=(d)=>{let u=X.get(t);if(!u)return;if(rn(t),d){let x=u.input.value.trim();if(!x){z(a("toasts.nameCannotBeEmpty"),{duration:2000}),ln(e,n,i);return}let S=u.originalLabel.trim();if(x===S)return;if(x===u.generatedName){z(a("toasts.nameMustDifferFromDefault"),{duration:2000});return}let v=k(),y=v.findIndex((q)=>q.id===t);if(y>=0)v[y].name=x,j(v),W(i)}},h={input:m,labelEl:c,originalLabel:o,actionsEl:p,originalActionsDisplay:r,generatedName:f,onKeyDown(d){if(d.key==="Enter")d.preventDefault(),s(!0);else if(d.key==="Escape")d.preventDefault(),s(!1)},onBlur(){s(!0)}};X.set(t,h),m.addEventListener("keydown",h.onKeyDown),m.addEventListener("blur",h.onBlur),setTimeout(()=>{m.focus(),m.select()},0)}function J(e,n,i={}){let{action:t,id:l,tone:c="default",title:p}=i,o=["qs-btn"];if(c==="danger")o.push("danger");if(c==="primary")o.push("primary");if(c==="subtle")o.push("subtle");let f=[];if(t)f.push(`data-action="${t}"`);if(l)f.push(`id="${l}"`);if(p)f.push(`title="${Y(p)}"`);let r=f.length?` ${f.join(" ")}`:"",m=D(n);return`<button type="button" class="${o.join(" ")}"${r}>${m}<span class="qs-btn-label">${Y(e)}</span></button>`}function Je(e,n,i,t={}){let{tone:l="default"}=t,c=["qs-icon-btn"];if(l==="danger")c.push("danger");return`<button type="button" class="${c.join(" ")}" data-action="${Y(e)}" title="${Y(i)}">${D(n)}</button>`}function U(e,n="default"){let i=["qs-pill"];if(n!=="default"){let t={accent:"qs-pill--accent",version:"qs-pill--version",channel:"qs-pill--channel","active-sync":"qs-pill--active-sync"};i.push(t[n])}return`<span class="${i.join(" ")}">${Y(e)}</span>`}function Ae(e,n={}){let{isSynced:i=!1,activeSyncId:t=!1}=n;return e.map((l)=>{let c=Y(ie(l)),p=l.items.some((h)=>h.startsWith("spotify:local:")),o=i&&l.id===t,f=[];if(o)f.push(U(a("ui.labels.activeSync"),"active-sync"));if(f.push(U(`${l.items.length} ${l.items.length===1?a("ui.itemSingular"):a("ui.itemPlural")}`,"accent")),p)f.push(U(a("ui.includesLocal")));let r=f.join(""),m=l.type==="auto"?"clock":l.type==="synced"?"repeat":"playlist",s=i?o?`${J(a("ui.buttons.exitSyncMode"),"x",{action:"deactivate-sync",tone:"danger"})}
             ${J(a("ui.buttons.export"),"download",{action:"export",title:a("ui.labels.exportToPlaylist")})}
             ${J(a("ui.buttons.convertToManual"),"copy",{action:"convert-to-manual",title:a("ui.labels.convertToManual")})}`:`${J(a("ui.buttons.activateSync"),"play",{action:"activate-sync",tone:"primary"})}
             ${J(a("ui.buttons.export"),"download",{action:"export",title:a("ui.labels.exportToPlaylist")})}
             ${J(a("ui.buttons.convertToManual"),"copy",{action:"convert-to-manual",title:a("ui.labels.convertToManual")})}`:"";return`
          <div class="qs-row" data-id="${l.id}">
            <div class="qs-row-main">
              <div class="qs-row-title">
                ${D(m)}
                <span>${c}</span>
                <span class="qs-title-actions">
                  ${Je("rename","edit",a("ui.labels.renameSnapshot"))}
                  ${l.name?Je("reset-name","repeat",a("ui.labels.resetName")):""}
                  ${Je("delete","x",a("ui.labels.deleteSnapshot"),{tone:"danger"})}
                </span>
              </div>
              <div class="qs-row-meta">${r}</div>
              <div class="qs-row-actions">
                ${i?s:`
                  ${J(a("ui.buttons.view"),"chevron-right",{action:"toggle-items",title:a("ui.labels.toggleItems")})}
                  ${J(a("ui.buttons.replaceQueue"),"skip-forward",{action:"replace-queue",title:a("ui.labels.replaceQueue"),tone:"primary"})}
                  ${J(a("ui.buttons.appendToQueue"),"plus-alt",{action:"append-queue",title:a("ui.labels.appendQueue")})}
                  ${J(a("ui.buttons.export"),"download",{action:"export",title:a("ui.labels.exportToPlaylist")})}
                `}
              </div>
            </div>
          </div>
          <div class="qs-items" data-id="${l.id}" style="display:none">
            <div class="qs-items-body">${a("ui.loading")}</div>
          </div>
        `}).join("")}function sn(e){let n=ne(),i=n.filter((s)=>s.type==="synced"),t=n.filter((s)=>s.type==="auto"),l=n.filter((s)=>s.type==="manual"),c=!!e.syncedSnapshotId,p=e.syncedSnapshotId,o=Ae(i,{isSynced:!0,activeSyncId:p,syncModeActive:c}),f=Ae(t,{syncModeActive:c}),r=Ae(l,{syncModeActive:c});return`
      ${`
      <div class="qs-section-card${c?" qs-sync-active":""}">
        <div class="qs-section-head">
          <div class="qs-section-heading">
            ${D("repeat")}
            ${U(String(i.length),"accent")}
            <div class="qs-section-text">
              <div class="qs-section-name">${a("ui.sections.syncedSnapshots")}</div>
              <div class="qs-section-caption">${a("ui.sections.syncedSnapshotsCaption")}</div>
            </div>
          </div>
          <div class="qs-actions">
            ${J(a("ui.buttons.createSyncedSnapshot"),"plus-alt",{id:"qs-new-synced",tone:"primary"})}
          </div>
        </div>
        <div class="qs-section-body">
          ${o||`<div class="qs-empty">${a("ui.empty.noSyncedSnapshots")}</div>`}
        </div>
      </div>
    `}
      <div class="qs-section-card">
        <div class="qs-section-head">
          <div class="qs-section-heading">
            ${D("playlist")}
            ${U(String(l.length),"accent")}
            <div class="qs-section-text">
              <div class="qs-section-name">${a("ui.sections.manualSnapshots")}</div>
              <div class="qs-section-caption">${a("ui.sections.manualSnapshotsCaption")}</div>
            </div>
          </div>
          <div class="qs-actions">
            ${J(a("ui.buttons.exportAll"),"download",{id:"qs-export-manuals",tone:"subtle"})}
            ${J(a("ui.buttons.saveNow"),"plus-alt",{id:"qs-new-manual",tone:"primary"})}
          </div>
        </div>
        <div class="qs-section-body">
          ${r||`<div class="qs-empty">${a("ui.empty.noManualSnapshots")}</div>`}
        </div>
      </div>
      <div class="qs-section-card">
        <div class="qs-section-head">
          <div class="qs-section-heading">
            ${D("clock")}
            ${U(String(t.length),"accent")}
            <div class="qs-section-text">
              <div class="qs-section-name">${a("ui.sections.automaticSnapshots")}</div>
              <div class="qs-section-caption">${a("ui.sections.automaticSnapshotsCaption")}</div>
            </div>
          </div>
          <div class="qs-actions">
            ${J(a("ui.buttons.clearAll"),"x",{id:"qs-clear-autos",tone:"danger"})}
            ${J(a("ui.buttons.exportAll"),"download",{id:"qs-export-autos",tone:"subtle"})}
          </div>
        </div>
        <div class="qs-section-body">
          ${f||`<div class="qs-empty">${a("ui.empty.noAutomaticSnapshots")}</div>`}
        </div>
      </div>
    `}function cn(){return`
        <div class="qs-header">
          <div class="qs-header-title">
            <div class="qs-header-icon">${D("queue",20)}</div>
            <span class="qs-header-badges">${U(`v${Oe}`,"version")}${qe?U(qe.toUpperCase(),"channel"):""}</span>
          </div>
          <div class="qs-header-actions">
            ${J(a("ui.buttons.refresh"),"repeat",{id:"qs-refresh",tone:"subtle"})}
            ${J(a("ui.buttons.exportSettings"),"download",{id:"qs-export-settings",title:a("ui.labels.exportSettings")})}
            ${J(a("ui.buttons.importSnapshots"),"chart-up",{id:"qs-import-snapshots",title:a("ui.labels.importSnapshots")})}
            ${J(a("ui.buttons.importSettings"),"chart-up",{id:"qs-import-settings",title:a("ui.labels.importSettings")})}
          </div>
        </div>
    `}function pn(e){let n=e.settingsCollapsed?"collapsed":"",i="chevron-right",l=!!e.syncedSnapshotId;return`
        <div class="qs-settings ${n}">
          <div class="qs-settings-header">
            <div class="qs-section-heading">
              ${D("grid-view")}
              <div class="qs-section-text">
                <div class="qs-section-name">${a("ui.sections.settings")}</div>
                  <div class="qs-section-caption">${a("ui.sections.settingsCaption")}</div>
              </div>
            </div>
            <button type="button" class="qs-settings-toggle" id="qs-settings-toggle">
              ${D("chevron-right")}
            </button>
          </div>
          <div class="qs-settings-content">
            <div class="qs-setting">
              <label class="qs-checkbox${l?" qs-disabled":""}"><input type="checkbox" id="qs-auto-enabled" ${e.autoEnabled?"checked":""} ${l?"disabled":""}/> ${D("brightness")}${a("settings.autoEnabled")}</label>
              <div class="qs-dim${l?" qs-disabled":""}">${a("settings.autoMode")} 
                <div class="qs-radio-group" id="qs-auto-mode-group">
                  <label class="qs-radio-label"><input type="radio" class="qs-radio" name="qs-auto-mode" value="timer" ${e.autoMode==="timer"?"checked":""} ${e.autoEnabled&&!l?"":"disabled"}/><span>${D("clock")} ${a("settings.timeBased")}</span></label>
                  <label class="qs-radio-label"><input type="radio" class="qs-radio" name="qs-auto-mode" value="on-change" ${e.autoMode==="on-change"?"checked":""} ${e.autoEnabled&&!l?"":"disabled"}/><span>${D("shuffle")} ${a("settings.queueChanges")}</span><span class="qs-icon"><span class="qs-icon-glyph">ⓘ</span><span class="qs-tooltip"><span class="qs-tooltip-emph">${a("settings.experimental")}</span>${a("settings.experimentalTooltip")}</span></span></label>
                </div>
              </div>
              <div class="qs-setting" style="margin-top:6px">
                <label class="qs-checkbox${l?" qs-disabled":""}"><input type="checkbox" id="qs-only-new" ${e.onlyNewItems?"checked":""} ${e.autoEnabled&&!l?"":"disabled"}/> ${D("search")} ${a("settings.onlyNewItems")}</label>
                <div style="opacity:0.7; font-size:12px">${a("settings.onlyNewItemsDescription")}</div>
              </div>
              <div class="qs-setting" style="margin-top:6px">
                <div style="opacity:0.7; font-size:12px">${a("settings.equalQueuesNote")}</div>
              </div>
              <div class="qs-setting" style="margin-top:12px">
                <label class="qs-checkbox"><input type="checkbox" id="qs-queue-warn-enabled" ${e.queueWarnEnabled?"checked":""}/> ${D("exclamation-circle")} ${a("settings.queueWarnEnabled")}</label>
                <div style="opacity:0.7; font-size:12px">${a("settings.queueWarnDescription")}</div>
              </div>
              <div class="qs-setting" style="margin-top:12px">
                <label class="qs-checkbox"><input type="checkbox" id="qs-prompt-manual-before-replace" ${e.promptManualBeforeReplace?"checked":""}/> ${D("copy")} ${a("settings.promptManualBeforeReplace")}</label>
                <div style="opacity:0.7; font-size:12px">${a("settings.promptManualDescription")}</div>
              </div>
              <div class="qs-setting" style="margin-top:12px">
                <label>${D("search")} ${a("settings.language")}</label>
                <select class="qs-input" id="qs-language">
                  <option value="" ${!e.language?"selected":""}>${a("settings.autoDetected")}</option>
                  <option value="en" ${e.language==="en"?"selected":""}>English</option>
                  <option value="de" ${e.language==="de"?"selected":""}>Deutsch</option>
                  <option value="es" ${e.language==="es"?"selected":""}>Español</option>
                  <option value="fr" ${e.language==="fr"?"selected":""}>Français</option>
                </select>
                <div style="opacity:0.7; font-size:12px">${a("settings.languageDescription")}</div>
              </div>
            </div>
            <div class="qs-right">
              <div class="qs-setting${l?" qs-disabled":""}">
                <label>${D("clock")} ${a("settings.interval")}</label>
                <input class="qs-input" type="number" id="qs-auto-interval-mins" min="0.5" step="0.5" value="${(e.autoIntervalMs/60000).toFixed(2)}" ${e.autoEnabled&&e.autoMode==="timer"&&!l?"":"disabled"} />
                <div style="opacity:0.7; font-size:12px">${a("settings.intervalDescription")}</div>
              </div>
              <div class="qs-setting${l?" qs-disabled":""}">
                <label>${D("chart-up")} ${a("settings.maxAutomaticSnapshots")}</label>
                <input class="qs-input" type="number" id="qs-max-autos" min="1" step="1" value="${e.maxAutosnapshots}" ${e.autoEnabled&&!l?"":"disabled"} />
                <div style="opacity:0.7; font-size:12px">${a("settings.maxAutomaticDescription")}</div>
              </div>
              <div class="qs-setting">
                <label>${D("queue")} ${a("settings.queueMaxSize")}</label>
                <input class="qs-input" type="number" id="qs-queue-max-size" min="10" step="1" value="${e.queueMaxSize}" ${e.queueWarnEnabled?"":"disabled"} />
                <div style="opacity:0.7; font-size:12px">${a("settings.queueMaxSizeDescription")}</div>
              </div>
              <div class="qs-setting">
                <label>${D("exclamation-circle")} ${a("settings.queueWarnThreshold")}</label>
                <input class="qs-input" type="number" id="qs-queue-warn-threshold" min="0" step="1" value="${e.queueWarnThreshold}" ${e.queueWarnEnabled?"":"disabled"} />
              </div>
            </div>
          </div>
        </div>
    `}function on(){let e=document.querySelector(".qs-header");if(e)e.outerHTML=cn()}function M(e){let n=document.querySelector(".qs-settings");if(n)n.outerHTML=pn(e.getSettings()),setTimeout(()=>{le(e)},0)}function ye(e){let n=e.getSettings(),i=sn(n),t=pn(n),c=`
      <div class="qs-container">
        ${cn()}
        ${t}
        <div id="qs-list">
          ${i||`<div style="opacity:0.7">${a("ui.empty.noSnapshots")}</div>`}
        </div>
      </div>
    `;if(Spicetify.PopupModal.display({title:g,content:c,isLarge:!0}),oe)document.removeEventListener("click",oe,!0),oe=null;if(re)document.removeEventListener("change",re,!0),re=null;oe=async function(o){let f=document.querySelector(".qs-container"),r=o.target;if(f&&r&&f.contains(r))o.stopPropagation();if(!f)return;if(!r)return;let m=k(),s=r.closest(".qs-btn, .qs-icon-btn, .qs-settings-toggle");if(s?.id==="qs-new-manual"){o.preventDefault(),se(),await te(),W(e);return}if(s?.id==="qs-new-synced"){o.preventDefault(),se();try{let y=e.getSettings(),q=!!y.syncedSnapshotId;if(q){if(await K({title:a("dialogs.switchSyncedSnapshot.title"),message:a("dialogs.switchSyncedSnapshot.message"),confirmLabel:a("dialogs.switchSyncedSnapshot.confirmLabel"),cancelLabel:a("dialogs.switchSyncedSnapshot.cancelLabel"),tone:"primary"})!=="confirm")return}let w=q?[]:await R(),T=E({type:"synced",createdAt:Date.now()}),b=(await xe({title:a("dialogs.saveSyncedSnapshot.title"),message:a("dialogs.saveSyncedSnapshot.message"),confirmLabel:a("dialogs.saveSyncedSnapshot.confirmLabel"),cancelLabel:a("dialogs.saveSyncedSnapshot.cancelLabel"),defaultValue:T}))?.trim()??null;if(b===null)return;else if(b===""){z(a("toasts.nameCannotBeEmpty"));return}let F={id:P(),createdAt:Date.now(),name:b===T?void 0:b,type:"synced",items:w,playbackPosition:Spicetify.Player.getProgress()},H=k();j([F,...H]);let ce={...y,syncedSnapshotId:F.id};if(e.setSettings(ce),q)await Spicetify.Platform.PlayerAPI.clearQueue(),await ge(F,s,e);W(e),M(e),A(a("toasts.syncActivated"))}catch(y){console.error(`${g}: synced snapshot creation failed`,y),z(a("toasts.failedToCreateSyncedSnapshot"))}return}if(s?.id==="qs-export-settings"){o.preventDefault();let y=e.getSettings();return await he(`${me}-settings.json`,y)}if(s?.id==="qs-import-settings")return o.preventDefault(),await tn(e);if(s?.id==="qs-import-snapshots")return o.preventDefault(),await an();if(s?.id==="qs-export-manuals"){o.preventDefault();let y=m.filter((q)=>q.type==="manual");return await he(`${me}-manual-snapshots.json`,y)}if(s?.id==="qs-export-autos"){o.preventDefault();let y=m.filter((q)=>q.type==="auto");return await he(`${me}-auto-snapshots.json`,y)}if(s?.id==="qs-clear-autos"){o.preventDefault();let y=m.filter((w)=>w.type==="auto").length;if(y===0){z(a("toasts.noAutomaticSnapshotsToClear"));return}if(await K({title:a("dialogs.clearAutomaticSnapshots.title"),message:a("dialogs.clearAutomaticSnapshots.message",{count:y}),confirmLabel:a("dialogs.clearAutomaticSnapshots.confirmLabel"),tone:"danger"})!=="confirm")return;Ne(),W(e),A(a("toasts.clearedAutomaticSnapshots",{count:y}));return}if(s?.id==="qs-refresh"){o.preventDefault(),on(),M(e),W(e);return}if(s?.id==="qs-settings-toggle"){o.preventDefault();let y=e.getSettings(),q={...y,settingsCollapsed:!y.settingsCollapsed};e.setSettings(q);let w=document.querySelector(".qs-settings"),T=document.querySelector(".qs-settings-content");if(w&&T)if(q.settingsCollapsed)w.classList.add("collapsed");else w.classList.remove("collapsed");return}if(!s)return;let h=s.closest(".qs-row"),d=s.getAttribute("data-action"),u=s.classList.contains("qs-icon-btn");if(!h||!d&&u)return;let x=h.getAttribute("data-id");if(!x)return;if(!X.has(x))se(x);let S=m.find((y)=>y.id===x);if(!S)return;if(u){if(d==="rename"){o.preventDefault(),ln(h,S,e);return}if(d==="reset-name"){o.preventDefault();let y=m.findIndex((q)=>q.id===x);if(y>=0)delete m[y].name,j(m),W(e);return}if(d==="delete"){if(await K({title:a("dialogs.deleteSnapshot.title"),message:a("dialogs.deleteSnapshot.message"),confirmLabel:a("dialogs.deleteSnapshot.confirmLabel"),tone:"danger"})!=="confirm")return;let q=ie(S),w=m.filter((b)=>b.id!==x);j(w);let T=e.getSettings();if(T.syncedSnapshotId===x){let b={...T,syncedSnapshotId:void 0};e.setSettings(b),M(e)}W(e),A(a("toasts.snapshotDeleted",{name:q}));return}return}let v=d;if(!v)return;if(v==="activate-sync"){if(O.has(x))return;O.add(x);try{let y=e.getSettings();if(y.promptManualBeforeReplace&&!y.syncedSnapshotId){let w=R();if(!G(w,S.items)){let T=await K({title:a("dialogs.saveCurrentQueue.title"),message:a("dialogs.saveCurrentQueue.message"),confirmLabel:a("dialogs.saveCurrentQueue.confirmLabel"),cancelLabel:a("dialogs.saveCurrentQueue.cancelLabel"),extraLabel:a("dialogs.saveCurrentQueue.extraLabel"),extraTone:"danger",tone:"primary"});if(T==="extra"){O.delete(x);return}if(T==="confirm")await te(),W(e)}}let q={...y,syncedSnapshotId:S.id};e.setSettings(q),await ge(S,s,e),W(e),M(e),A(a("toasts.syncActivated"))}catch(y){console.error(`${g}: activate sync failed`,y),z(a("toasts.failedToActivateSync"))}finally{O.delete(x)}return}if(v==="deactivate-sync"){o.preventDefault();let q={...e.getSettings(),syncedSnapshotId:void 0};e.setSettings(q),W(e),M(e),A(a("toasts.syncDeactivated"));return}if(v==="convert-to-manual"){if(o.preventDefault(),await K({title:a("dialogs.convertToManual.title"),message:a("dialogs.convertToManual.message"),confirmLabel:a("dialogs.convertToManual.confirmLabel"),tone:"primary"})!=="confirm")return;let q=k(),w=q.findIndex((T)=>T.id===x);if(w>=0){q[w].type="manual",j(q);let T=e.getSettings();if(T.syncedSnapshotId===x){let b={...T,syncedSnapshotId:void 0};e.setSettings(b),M(e)}W(e),A(a("toasts.convertedToManual"))}return}if(v==="toggle-items"){let y=h.nextElementSibling,q=s;if(!y||!y.classList.contains("qs-items"))return;if(y.style.display==="none"||!y.style.display){y.style.display="block",V(q,a("ui.buttons.hide")),Te(q,"chart-down");let T=y.querySelector(".qs-items-body");if(T){T.textContent=a("ui.loading");try{let b=await _e(S);T.innerHTML=b.map((F,H)=>`<div>${H+1}. ${Y(F)}</div>`).join("")}catch(b){T.textContent=a("ui.failedToLoadItems")}}}else y.style.display="none",V(q,a("ui.buttons.view")),Te(q,"chevron-right");return}if(v==="export"){if(O.has(x))return;O.add(x),await en(S,s),O.delete(x);return}if(v==="append-queue"){if(O.has(x))return;O.add(x);try{await nn(S,s)}finally{O.delete(x)}return}if(v==="replace-queue"){if(O.has(x))return;O.add(x);try{if(e.getSettings().promptManualBeforeReplace){let q=await K({title:a("dialogs.saveCurrentQueue.title"),message:a("dialogs.saveCurrentQueue.message"),confirmLabel:a("dialogs.saveCurrentQueue.confirmLabel"),cancelLabel:a("dialogs.saveCurrentQueue.cancelLabel"),extraLabel:a("dialogs.saveCurrentQueue.extraLabel"),extraTone:"danger",tone:"primary"});if(q==="extra")return;if(q==="confirm")await te(),W(e)}await ge(S,s,e)}finally{O.delete(x)}return}},re=function(o){let f=document.querySelector(".qs-container"),r=o.target;if(!f||!r||!f.contains(r))return;if(o.stopPropagation(),r.id==="qs-auto-enabled"){let s=!!r.checked,d={...e.getSettings(),autoEnabled:s};e.setSettings(d),se(),le(e);return}if(r.name==="qs-auto-mode"){let m=r,s=e.getSettings(),h=m.value==="on-change"?"on-change":"timer",d={...s,autoMode:h};e.setSettings(d),le(e);return}if(r.id==="qs-only-new"){let s=!!r.checked,d={...e.getSettings(),onlyNewItems:s};e.setSettings(d);return}if(r.id==="qs-auto-interval-mins"){let m=r,s=e.getSettings(),h=parseFloat(m.value),d=isFinite(h)&&h>=0.5?h:s.autoIntervalMs/60000,u={...s,autoIntervalMs:Math.round(d*60000)};e.setSettings(u);return}if(r.id==="qs-max-autos"){let m=r,s=e.getSettings(),h=parseInt(m.value,10),d=Number.isFinite(h)&&h>0?h:s.maxAutosnapshots,u={...s,maxAutosnapshots:d};e.setSettings(u),ke(u),W(e);return}if(r.id==="qs-queue-warn-enabled"){let s=r.checked,d={...e.getSettings(),queueWarnEnabled:s};e.setSettings(d),le(e);return}if(r.id==="qs-queue-max-size"){let m=r,s=e.getSettings(),h=parseInt(m.value,10),d=Number.isFinite(h)&&h>1?h:s.queueMaxSize,u={...s,queueMaxSize:d};e.setSettings(u);return}if(r.id==="qs-queue-warn-threshold"){let m=r,s=e.getSettings(),h=parseInt(m.value,10),d=Number.isFinite(h)&&h>=0?h:s.queueWarnThreshold,u={...s,queueWarnThreshold:d};e.setSettings(u);return}if(r.id==="qs-prompt-manual-before-replace"){let s=r.checked,d={...e.getSettings(),promptManualBeforeReplace:s};e.setSettings(d);return}if(r.id==="qs-language"){let s=r.value||void 0,d={...e.getSettings(),language:s};e.setSettings(d),ve(),on(),M(e),W(e);return}},document.addEventListener("click",oe,!0),document.addEventListener("change",re,!0),le(e)}function W(e){se();let n=document.getElementById("qs-list");if(n){let i=e?.getSettings()??Q(),t=sn(i);n.innerHTML=t||`<div style="opacity:0.7">${a("ui.empty.noSnapshots")}</div>`}}function dn(e){let n=[],i=null,t=[],l=null,c=null;function p(){if(i!==null)clearInterval(i),i=null}async function o(d){try{if(!d.autoEnabled)return;let u=R();if(!u.length){console.log(`${g}: queue is empty, skipping auto snapshot`);return}if(d.onlyNewItems){let v=new Set(n);if(!u.some((q)=>!v.has(q))){n=u;return}}if(G(u,n)){n=u;return}if(k().filter((v)=>v.type==="auto").some((v)=>G(v.items,u))){n=u;return}let S={id:P(),createdAt:Date.now(),type:"auto",items:u};de(S,d),n=u}catch(u){console.error(`${g}: auto snapshot error`,u),z(a("toasts.failedToSaveAutomatic"))}}function f(d){if(p(),!d.autoEnabled)return;i=window.setInterval(()=>o(d),d.autoIntervalMs),c=d.autoIntervalMs}function r(){for(let d of t)d();t=[]}function m(d){if(r(),!d.autoEnabled)return;try{let u=Spicetify?.Player?.origin?._events;if(!u?.addListener||!u?.removeListener)throw Error("events API not available");let x=(S)=>{o(d)};u.addListener("queue_update",x),t.push(()=>{try{u.removeListener("queue_update",x)}catch(S){console.error(`${g}: failed to remove queue_update listener`,S)}})}catch(u){console.error(`${g}: failed to start queue update watcher`,u),z(a("toasts.failedToStartQueueWatcher"))}}function s(){let d=ne()[0];if(d?.items?.length)n=d.items.slice()}function h(d){let u=!d.autoEnabled?null:d.autoMode;if(u===l){if(u==="timer"&&c!==d.autoIntervalMs)f(d);return}if(l==="on-change")r();else if(l==="timer")p();if(u==="on-change")m(d);else if(u==="timer")f(d);l=u}return{startAutoTimer:f,primeFromExisting:s,applyAutoMode:h}}function mn(e){let n=null,i=null,t=0,l=null,c=30000;async function p(){try{let r=e();if(!r.queueWarnEnabled)return;let{queueMaxSize:m,queueWarnThreshold:s}=r;if(s<0||m<=1)return;let d=R().length;if(l!==null&&d<=l)return;if(l=d,!d)return;let u=Math.max(0,m-d);if(u<=s){let x=Date.now();if(i!==u||x-t>=c){let S=m-u;I(a("toasts.queueNearlyFull",{used:S,max:m}),{duration:15000,id:"queue-nearly-full"}),i=u,t=x}}}catch(r){console.warn(`${g}: queue capacity check failed`,r)}}function o(){if(n){try{n()}catch{}n=null}l=null}function f(){o();try{let r=Spicetify?.Player?.origin?._events;if(!r?.addListener||!r?.removeListener)throw Error("queue_update events API not available");let m=(s)=>{p()};r.addListener("queue_update",m),n=()=>{try{r.removeListener("queue_update",m)}catch(s){console.error(`${g}: failed to remove queue_update listener (capacity watcher)`,s)}},p()}catch(r){console.error(`${g}: failed to start capacity watcher`,r),z(a("toasts.failedToStartCapacityWatcher"))}}return{start:f,stop:o,checkAndWarnOnce:p}}function un(e){let n=null,i=[],t=!1,l=!1;async function c(d){let u=e();if(!u.syncedSnapshotId||!t)return;let x=k(),S=x.findIndex((v)=>v.id===u.syncedSnapshotId);if(S>=0)x[S].playbackPosition=d,j(x)}async function p(d){let u=e();if(!u.syncedSnapshotId)return;let x=k(),S=x.findIndex((v)=>v.id===u.syncedSnapshotId);if(S>=0){if(d.length===0){console.debug(`${g}: skipping sync of empty queue to snapshot`);return}x[S].items=d.slice(),x[S].playbackPosition=Spicetify.Player.getProgress(),j(x)}else{console.warn(`${g}: synced snapshot ${u.syncedSnapshotId} no longer exists, deactivating sync mode`);let v={...u,syncedSnapshotId:void 0};pe(v),I(a("toasts.syncedSnapshotNotFound"))}}async function o(){try{if(!e().syncedSnapshotId||!t||l)return;let u=R();if(!G(u,i))await p(u),i=u.slice()}catch(d){console.error(`${g}: queue sync error`,d)}}function f(){if(n){try{n()}catch{}n=null}t=!1,l=!1,i=[]}function r(){if(f(),!e().syncedSnapshotId)return;try{let u=Spicetify?.Player?.origin?._events;if(!u?.addListener||!u?.removeListener)throw Error("events API not available");let x=(v)=>{o()},S=(v)=>{c(v.data)};u.addListener("queue_update",x),Spicetify.Player.addEventListener("onprogress",S),n=()=>{try{u.removeListener("queue_update",x),Spicetify.Player.removeEventListener("onprogress",S)}catch(v){console.error(`${g}: failed to remove listeners (sync manager)`,v)}},t=!0,i=R()}catch(u){console.error(`${g}: failed to start queue sync manager`,u),z(a("toasts.failedToStartSyncManager"))}}function m(d){let u=!!d.syncedSnapshotId;if(u&&!t)r();else if(!u&&t)f()}function s(){l=!0,console.debug(`${g}: sync manager suspended`)}async function h(){l=!1,i=R(),console.debug(`${g}: sync manager resumed`)}return{start:r,stop:f,applySync:m,suspend:s,resume:h}}async function Dn(){while(!Spicetify?.showNotification||!Spicetify?.CosmosAsync||!Spicetify?.LocalStorage)await new Promise((p)=>setTimeout(p,100));let e=Q(),n=dn(()=>e);n.primeFromExisting(),n.applyAutoMode(e);let i=un(()=>e);if(e.syncedSnapshotId)i.applySync(e);let t=mn(()=>e);t.start();let l={getSettings:()=>e,setSettings:(p)=>{e=p,pe(p),n.applyAutoMode(p),i.applySync(p),t.checkAndWarnOnce()},getSyncManager:()=>i},c="queue";try{if(Spicetify?.Topbar?.Button)new Spicetify.Topbar.Button(g,c,()=>ye(l),void 0,!0)}catch{console.error(`${g}: ${a("errors.failedToAddTopbarButton")}`)}try{let p=(f,r,m)=>{try{if(m){if(Spicetify.URI.fromString(m)?.type===Spicetify.URI.Type.QUEUE)return!0;if(m.includes(":queue"))return!0}return(Spicetify.Platform?.History?.location?.pathname||"").includes("queue")}catch{}return!1};new Spicetify.ContextMenu.Item(g,()=>ye(l),p,c).register()}catch{console.error(`${g}: ${a("errors.failedToAddContextMenuItem")}`)}try{Spicetify.Keyboard.registerShortcut({key:"q",ctrl:!0,alt:!0},()=>ye(l))}catch{console.error(`${g}: ${a("errors.failedToAddKeyboardShortcut")}`)}}var Ln=Dn;export{Ln as default};

(async () => {
  if (!document.getElementById(`queueDmanager`)) {
    var el = document.createElement('style');
    el.id = `queueDmanager`;
    el.textContent = (String.raw`.qs-container{display:flex;overflow:visible;flex-direction:column;gap:18px}.qs-header{display:flex;background:linear-gradient(135deg,#34d39929,#2563eb1f);border:1px solid #ffffff0f;border-radius:12px;justify-content:space-between;align-items: center;gap:12px;padding:16px}.qs-header-title{display:flex;align-items: center;gap:12px;font-weight:600}.qs-header-text{display:flex;flex-direction:column;gap:4px}.qs-header-app{display:flex;align-items: center;gap:10px}.qs-header-badges{display:inline-flex;align-items: center;gap:6px}.qs-header-icon{display:inline-flex;background:#0006;border-radius:50%;justify-content:center;align-items: center;width:36px;height:36px}.qs-header-name{font-size:18px}.qs-header-sub,.qs-header-sub-alt{opacity:.75;font-size:13px}.qs-actions{display:flex;flex-wrap:wrap;justify-content:flex-end;gap:8px}.qs-header-actions{display:flex;flex-wrap:wrap;justify-content:flex-end;gap:8px;max-width:400px}.qs-header-actions .qs-btn{flex:none;max-width:calc(50% - 4px)}.qs-settings{display:flex;background:var(--spice-section-bg,#ffffff0d);overflow:visible;box-sizing:border-box;border:1px solid #ffffff0d;border-radius:12px;flex-direction:column;gap:18px;max-width:100%;padding:16px;transition:padding-bottom .3s}.qs-settings-header{display:flex;justify-content:space-between;align-items: center;gap:12px;margin-bottom:8px}.qs-settings-toggle{display:inline-flex;cursor:pointer;color:inherit;background:0 0;border:1px solid #0000;border-radius:50%;justify-content:center;align-items: center;width:32px;height:32px;padding:0;transition:background .15s,transform .12s,border .12s}.qs-settings-toggle:hover{background:#ffffff14;border-color:#ffffff1f}.qs-settings-toggle:focus-visible{outline:2px solid #60a5facc;outline-offset:2px}.qs-settings-toggle .qs-svg-icon{width:16px;height:16px;transition:transform .2s}.qs-settings-content{display:grid;grid-template-columns:1fr 1fr;opacity:1;gap:18px;max-height:800px;transition:max-height .4s cubic-bezier(.4,0,.2,1),opacity .3s}.qs-settings.collapsed .qs-settings-content{opacity:0;pointer-events:none;max-height:0}.qs-settings.collapsed{padding-bottom:0}.qs-settings:not(.collapsed) .qs-settings-toggle .qs-svg-icon{transform:rotate(90deg)}.qs-right{display:flex;flex-direction:column;gap:16px}.qs-setting{display:flex;flex-direction:column;gap:6px}.qs-setting label{display:inline-flex;align-items: center;gap:8px;font-weight:600}.qs-dim{color:#ffffffb3;font-size:12px}.qs-row{display:flex;background:#00000059;border:1px solid #ffffff0a;border-radius:10px;flex-direction:column;gap:12px;padding:12px 16px;box-shadow:0 10px 30px #00000040}.qs-row+.qs-row{margin-top:12px}.qs-row-main{display:flex;flex-direction:column;gap:10px}.qs-row-title{display:inline-flex;align-items: center;gap:8px;font-weight:600}.qs-title-actions{display:inline-flex;align-items: center;gap:6px;margin-left:8px}.qs-icon-btn{display:inline-flex;cursor:pointer;color:inherit;background:0 0;border:1px solid #0000;border-radius:50%;justify-content:center;align-items: center;width:26px;height:26px;padding:0;transition:background .15s,transform .12s,border .12s}.qs-icon-btn:hover{background:linear-gradient(135deg,#60a5fa59,#3b82f633);border-color:#60a5fa66;transform:translateY(-1px)}.qs-icon-btn:focus-visible{outline:2px solid #60a5facc;outline-offset:2px}.qs-icon-btn.danger{color:#f87171d9}.qs-icon-btn.danger:hover{color:#f87171;background:#f8717129;border-color:#f8717140}.qs-icon-btn .qs-svg-icon{width:16px;height:16px}.qs-row-meta{display:flex;flex-wrap:wrap;align-items: center;gap:6px;font-size:12px}.qs-row-actions{display:flex;flex-wrap:wrap;gap:10px;padding:2px 0}.qs-row-actions .qs-btn{flex:none;justify-content:flex-start}.qs-btn{display:inline-flex;color:inherit;cursor:pointer;text-decoration:none;background:#ffffff14;border:1px solid #0000;border-radius:8px;justify-content:center;align-items: center;gap:8px;padding:6px 10px;transition:transform .12s,box-shadow .12s,border .12s;font-weight:600}.qs-btn.primary{background:linear-gradient(135deg,#60a5fae6,#3b82f6e6);border-color:#60a5fa59}.qs-btn.subtle{background:#ffffff0a;border-color:#ffffff14}.qs-btn.danger{background:#f8717129;border-color:#f8717140}.qs-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px #00000040}.qs-btn:focus-visible{outline:2px solid #60a5facc;outline-offset:2px}.qs-btn-icon{display:inline-flex;justify-content:center;align-items: center}.qs-btn-label{white-space:nowrap}.qs-svg-icon{display:block;fill:currentColor;width:16px;height:16px}.qs-section-card{display:flex;background:#00000059;border:1px solid #ffffff0d;border-radius:12px;flex-direction:column;gap:12px;padding:16px}.qs-section-head{display:flex;flex-wrap:wrap;justify-content:space-between;align-items: center;gap:12px}.qs-section-heading{display:inline-flex;align-items: center;gap:12px;font-weight:600}.qs-section-text{display:flex;flex-direction:column;gap:2px}.qs-section-name{font-size:16px}.qs-section-caption{opacity:.75;font-size:12px}.qs-section-body{display:flex;flex-direction:column}.qs-empty{opacity:.6;padding:12px;font-size:13px}.qs-input{color:inherit;background:#00000040;border:1px solid #ffffff1a;border-radius:8px;padding:8px 10px;font-size:14px}.qs-input:disabled{opacity:.6;cursor:not-allowed}.qs-checkbox{display:inline-flex;align-items: center;gap:10px}.qs-radio-group{display:flex;flex-wrap:wrap;align-items: flex-start;gap:12px;max-width:100%;margin-top:6px}.qs-radio-label{display:flex;align-items: flex-start;gap:6px;min-width:0}.qs-radio-label span{display:inline-flex;flex-wrap:wrap;align-items: center;gap:6px}.qs-icon{display:inline-flex;position:relative;border-radius:50%;flex-shrink:0;justify-content:center;align-items: center;width:18px;height:18px;margin-left:4px;font-size:12px;line-height:16px}.qs-icon-glyph{opacity:.7;transition:opacity .12s ease-in-out}.qs-icon:hover .qs-icon-glyph{opacity:1}.qs-icon>.qs-tooltip{position:absolute;white-space:normal;word-wrap:break-word;overflow-wrap:break-word;text-align:left;color:var(--spice-text,#fff);pointer-events:none;opacity:0;z-index:9999;background:#121212;border:1px solid #ffffff14;border-radius:6px;min-width:200px;max-width:400px;padding:10px 12px;transition:opacity .12s ease-in-out;font-size:12px;bottom:calc(100% + 6px);left:50%;transform:translate(-50%);box-shadow:0 4px 14px #00000059}.qs-icon:hover>.qs-tooltip{opacity:1}.qs-tooltip .qs-tooltip-emph{color:#ff4e4e}.qs-radio:disabled{cursor:not-allowed}.qs-radio:disabled+span{opacity:.6;cursor:not-allowed}.qs-inline-input{color:inherit;background:#00000073;border:1px solid #fff3;border-radius:6px;width:100%;max-width:240px;padding:6px 8px;font-size:14px}.qs-dialog-input{color:inherit;background:#00000059;border:1px solid #ffffff2e;border-radius:8px;padding:8px 10px;font-size:14px}.qs-items{background:#3b82f61f;border-left:2px solid #3b82f659;border-radius:8px;margin:10px 0 14px;padding:12px}.qs-items-body{display:flex;overflow:auto;flex-direction:column;gap:4px;max-height:240px;font-size:13px}.qs-pill{display:inline-flex;text-transform:uppercase;letter-spacing:.5px;background:#ffffff1f;border-radius:999px;justify-content:center;align-items: center;padding:2px 8px;font-size:11px;font-weight:600}.qs-pill--accent{background:linear-gradient(135deg,#3b82f6d9,#6366f1d9)}.qs-pill--version{background:#ffffff1f}.qs-pill--channel{background:#f8717159}.qs-pill--active-sync{background:linear-gradient(135deg,#22c55ef2,#10b981f2);font-size:14px;font-weight:bolder;box-shadow:0 0 25px #22c55e66}.qs-confirm-backdrop{position:fixed;display:flex;z-index:100;backdrop-filter:blur(2px);background:#0009;justify-content:center;align-items: center;inset:0}.qs-confirm-dialog{background:var(--spice-section-bg,#202020f2);display:flex;border:1px solid #ffffff14;border-radius:12px;flex-direction:column;gap:16px;width:min(90vw,360px);max-width:360px;padding:20px 22px;box-shadow:0 18px 36px #00000073}.qs-confirm-title{font-size:16px;font-weight:600}.qs-confirm-message{opacity:.85;font-size:13px;line-height:1.5}.qs-confirm-actions{display:flex;justify-content:flex-end;gap:10px}.qs-section-card.qs-disabled,.qs-settings.qs-disabled{opacity:.6;pointer-events:none;position:relative}.qs-section-card.qs-sync-active{border:2px solid #34d39966;box-shadow:0 0 0 1px #34d39933}.qs-row.qs-disabled{opacity:.5;cursor:not-allowed}.qs-row.qs-disabled .qs-row-actions button{pointer-events:none}@media (max-width:860px){.qs-header{flex-direction:column;align-items: flex-start}.qs-actions{justify-content:flex-start;width:100%}.qs-header-actions{justify-content:flex-start;width:100%;max-width:none}.qs-header-actions .qs-btn{max-width:100%}.qs-row{grid-template-columns:1fr}.qs-row-actions{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}.qs-radio-group{flex-direction:column;align-items: flex-start;gap:8px}}.qs-toast-container{position:fixed;display:flex;z-index:2147480000;pointer-events:none;flex-direction:column;gap:12px;top:24px;left:24px}.qs-toast{display:flex;color:var(--spice-text,#fff);pointer-events:auto;opacity:0;position:relative;overflow:hidden;background:#202020eb;border:1px solid #ffffff12;border-radius:10px;align-items: flex-start;gap:10px;min-width:240px;max-width:min(360px,90vw);padding:12px 14px;transition:transform .2s,opacity .2s;font-size:13px;line-height:1.45;transform:translateY(-4px);box-shadow:0 14px 32px #00000073}.qs-toast--enter{opacity:1;transform:translateY(0)}.qs-toast--exit{opacity:0;transform:translateY(-4px)}.qs-toast--swipe-exit{opacity:0;transition:transform .2s,opacity .2s;transform:translate(-160px)}.qs-toast--dragging{transition:none!important}.qs-toast:focus-within{outline:2px solid #60a5facc;outline-offset:2px}.qs-toast-message{flex:auto;padding-right:8px}.qs-toast-close{appearance:none;color:inherit;cursor:pointer;opacity:.7;background:0 0;border:none;padding:0 2px;transition:opacity .12s;font-size:18px;line-height:1}.qs-toast-close:hover{opacity:1}.qs-toast-close:focus-visible{opacity:1}.qs-toast-close:focus-visible{outline:2px solid #60a5facc;outline-offset:2px}.qs-toast-close--hidden{display:none}.qs-toast-progress{position:absolute;transform-origin:left;opacity:0;pointer-events:none;background:#ffffff26;border-radius:999px;height:3px;transition:opacity .16s;bottom:8px;left:10px;right:10px}.qs-toast-progress__bar{border-radius:inherit;transform-origin:left;background:#ffffffb3;width:100%;height:100%;transition:transform 80ms linear;transform:scaleX(0)}.qs-toast-progress--hidden{opacity:0}.qs-toast-progress--visible{opacity:1}.qs-toast--success .qs-toast-progress__bar{background:#bbf7d0d9}.qs-toast--danger .qs-toast-progress__bar{background:#fecacae6}.qs-toast--warning .qs-toast-progress__bar{background:#1e293be6}.qs-toast--warning .qs-toast-progress{background:#0f172a59}.qs-toast--success{background:linear-gradient(135deg,#22c55ed9,#10b981d9);border-color:#22c55e73}.qs-toast--danger{background:linear-gradient(135deg,#f87171eb,#dc2626eb);border-color:#f871718c}.qs-toast--warning{color:#1f1f1f;background:linear-gradient(135deg,#facc15e6,#fbbf24e6);border-color:#eab3088c}.qs-toast-content{display:flex;flex-direction:column;flex:auto;gap:4px}.qs-toast-title{font-size:14px;font-weight:700;line-height:1.3}.qs-toast--warning .qs-toast-title{color:#1f1f1f}.qs-toast-message{font-size:13px;line-height:1.45}@media (max-width:860px){.qs-toast-container{gap:10px;top:12px;left:50%;transform:translate(-50%)}.qs-toast{max-width:min(420px,92vw)}}
`).trim();
    document.head.appendChild(el);
  }
})();

})();
