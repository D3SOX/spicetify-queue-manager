(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var h,b,x,n,w,E,i,s,o,r,l,a,P,D,I,d,S,k,M,j,q,c,u,z,F,e;function N(){var e;try{var t,a=Spicetify.LocalStorage.get(r);return a?{autoEnabled:null!=(e=(t=JSON.parse(a)).autoEnabled)?e:l.autoEnabled,autoIntervalMs:("number"==typeof t.autoIntervalMs&&0<t.autoIntervalMs?t:l).autoIntervalMs,maxAutosnapshots:("number"==typeof t.maxAutosnapshots&&0<t.maxAutosnapshots?t:l).maxAutosnapshots,autoMode:"timer"===t.autoMode?"timer":"on-change",onlyNewItems:!1!==t.onlyNewItems,queueWarnEnabled:!1!==t.queueWarnEnabled,queueMaxSize:("number"==typeof t.queueMaxSize&&1<t.queueMaxSize?t:l).queueMaxSize,queueWarnThreshold:("number"==typeof t.queueWarnThreshold&&0<=t.queueWarnThreshold?t:l).queueWarnThreshold,promptManualBeforeReplace:!1!==t.promptManualBeforeReplace}:l}catch(e){return l}}function W(){try{var e,t=Spicetify.LocalStorage.get(a);return t?(e=JSON.parse(t),Array.isArray(e)?e:[]):[]}catch(e){return[]}}function t(e){return e.sort((e,t)=>t.createdAt-e.createdAt)}function O(e){t(e),Spicetify.LocalStorage.set(a,JSON.stringify(e))}function p(){return t(W())}function T(e,t){var t=null!=t?t:N(),a=W(),n=a.filter(e=>"manual"===e.type),a=a.filter(e=>"auto"===e.type);"auto"===e.type?(t=[e,...a].slice(0,t.maxAutosnapshots),O([...n,...t])):O([e,...n,...a])}function m(e){return Number.isFinite(e)&&0<e}function C(e){var t,{track:a,bar:n}=(e=>{let t,a,n=null!=(t=e.querySelector(".qs-toast-progress"))?t:null,i=null!=(a=null==n?void 0:n.querySelector(".qs-toast-progress__bar"))?a:null;return n?n.classList.contains("qs-toast-progress--hidden")||n.classList.contains("qs-toast-progress--visible")||n.classList.add("qs-toast-progress--hidden"):((n=document.createElement("div")).className="qs-toast-progress qs-toast-progress--hidden",n.setAttribute("aria-hidden","true")),i?i.parentElement!==n&&n.appendChild(i):((i=document.createElement("div")).className="qs-toast-progress__bar",i.style.transform="scaleX(0)",n.appendChild(i)),n.parentElement===e&&!n.nextSibling||e.appendChild(n),{track:n,bar:i}})(e);let i=k.get(e);return i?(i.progressTrack=a,i.progressBar=n):(t=performance.now(),i={timeoutId:void 0,rafId:void 0,startTime:t,endTime:t,remaining:1/0,totalDuration:1/0,progressTrack:a,progressBar:n},k.set(e,i)),i}function f(e,t){let a=k.get(e);(a=a&&a.progressTrack&&a.progressBar?a:C(e)).progressTrack&&a.progressBar&&(null===t||Number.isNaN(t)||t<0?(a.progressTrack.classList.remove("qs-toast-progress--visible"),a.progressTrack.classList.add("qs-toast-progress--hidden"),a.progressBar.style.transform="scaleX(0)"):(e=Math.min(1,Math.max(0,t)),a.progressTrack.classList.remove("qs-toast-progress--hidden"),a.progressTrack.classList.add("qs-toast-progress--visible"),a.progressBar.style.transform=`scaleX(${e})`))}function H(e){var t=k.get(e);if(t&&m(t.remaining))return t.remaining<=0?void A(e):void L(e,t.remaining,!1);t=(e=>(e=e.dataset.toastDuration)&&(e=Number(e),Number.isFinite(e))&&0<e?e:null)(e);t&&m(t)?L(e,t):f(e,null)}function V(e){if("string"!=typeof e)return e;e=e.trim();if(e.length)return e;throw new Error(P+" toast message cannot be empty")}function Y(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);"string"==typeof t?e.textContent=t:e.appendChild(t)}function K(e,t){0<t&&isFinite(t)?e.dataset.toastDuration=String(t):delete e.dataset.toastDuration}function L(e,t,a=!0){var n,i=C(e);$(e),t<=0||!isFinite(t)?(i.remaining=1/0,i.endTime=1/0,f(e,null)):(n=performance.now(),i.startTime=n,i.endTime=n+t,i.remaining=t,a&&(i.totalDuration=t),f(e,i.totalDuration<=0?1:1-i.remaining/i.totalDuration),i.timeoutId=window.setTimeout(()=>{A(e)},t),i.rafId=window.requestAnimationFrame(()=>function e(t){var a,n,i=k.get(t);i&&(m(i.totalDuration)?(a=performance.now(),a=Math.max(0,i.endTime-a),i.remaining=a,n=i.totalDuration<=0?1:1-a/i.totalDuration,f(t,n),i.rafId=0<a?window.requestAnimationFrame(()=>e(t)):void 0):(f(t,null),i.rafId=void 0))}(e)))}function $(e){e=k.get(e);e&&("number"==typeof e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=void 0),"number"==typeof e.rafId)&&(cancelAnimationFrame(e.rafId),e.rafId=void 0)}function A(e,t="default"){$(e),k.delete(e),e.classList.remove("qs-toast--enter","qs-toast--swipe-exit"),e.classList.add("swipe"===t?"qs-toast--swipe-exit":"qs-toast--exit");let a,n=()=>{e.removeEventListener("transitionend",n),e.removeEventListener("animationend",n),void 0!==a&&window.clearTimeout(a),e.remove(),S&&!S.childElementCount&&(S.remove(),S=null)};e.addEventListener("transitionend",n),e.addEventListener("animationend",n),a=window.setTimeout(n,450),e.setAttribute("aria-hidden","true")}function G(t,a={}){let{tone:e="default",duration:n=3600,dismissible:i,id:s}=a;S&&document.body.contains(S)||((S=document.createElement("div")).className="qs-toast-container",S.setAttribute("role","region"),S.setAttribute("aria-live","polite"),S.setAttribute("aria-label","Notifications"),document.body.appendChild(S));a=S;if(s){let e=Array.from(a.children).find(e=>e instanceof HTMLElement&&e.dataset.toastId===s);if(e)return e.classList.remove("qs-toast--exit"),e.dataset.toastId=s,(r=e.querySelector(".qs-toast-message"))&&Y(r,V(t)),K(e,n),L(e,n),{close:()=>A(e),element:e}}let o=document.createElement("div");o.className="qs-toast qs-toast--"+e,o.setAttribute("role","status"),o.setAttribute("aria-live","danger"===e?"assertive":"polite"),s&&(o.dataset.toastId=s);var r=document.createElement("div"),l=(r.className="qs-toast-content",document.createElement("div")),d=(l.className="qs-toast-title",l.textContent=P,document.createElement("div")),t=(d.className="qs-toast-message",V(t)),t=(Y(d,t),document.createElement("button")),c=(t.type="button",t.className="qs-toast-close",t.setAttribute("aria-label","Dismiss notification"),t.innerHTML="&times;",t.addEventListener("click",e=>{e.preventDefault(),A(o)}),null!=i?i:!(0<n&&isFinite(n)));!c&&0<n&&isFinite(n)&&t.classList.add("qs-toast-close--hidden"),r.appendChild(l),r.appendChild(d),o.appendChild(r),o.appendChild(t),a.appendChild(o),o.offsetWidth,o.classList.add("qs-toast--enter"),K(o,n),L(o,n),o.addEventListener("mouseenter",()=>{$(o);var e,t=k.get(o);t&&Number.isFinite(t.remaining)&&(e=performance.now(),t.remaining=Math.max(0,t.endTime-e))}),o.addEventListener("mouseleave",()=>{H(o)});let u=0,p=0,m=!1,f=80,g=e=>{m&&((e=(p=e)-u)<0?(e=Math.max(e,-200),o.style.transform=`translateX(${e}px)`,o.style.opacity=String(Math.max(0,1-Math.abs(e)/160))):(o.style.transform="translateX(0px)",o.style.opacity="1"))},v=e=>{m=!1,o.classList.remove("qs-toast--dragging"),o.style.removeProperty("transition"),o.style.removeProperty("transform"),o.style.removeProperty("opacity"),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",q),document.removeEventListener("touchcancel",w),e?A(o,"swipe"):(o.classList.add("qs-toast--enter"),H(o))},y=()=>{m&&v(!1)},h=e=>{g(e.clientX),m&&e.preventDefault()},b=e=>{m&&(e=e.clientX-u,v(e<=-f))},x=e=>{var t;m&&(t=e.touches[0])&&(g(t.clientX),e.preventDefault())},q=e=>{m&&((e=e.changedTouches[0])?(e=e.clientX-u,v(e<=-f)):v(!1))},w=()=>{m&&v(!1)},E=e=>{m=!0,u=e,p=e,o.classList.add("qs-toast--dragging"),$(o),o.style.transition="none"};return o.addEventListener("mousedown",e=>{0===e.button&&(E(e.clientX),document.addEventListener("mousemove",h),document.addEventListener("mouseup",b),window.addEventListener("blur",y,{once:!0}))}),o.addEventListener("touchstart",e=>{e=e.touches[0];e&&(E(e.clientX),document.addEventListener("touchmove",x,{passive:!1}),document.addEventListener("touchend",q),document.addEventListener("touchcancel",w),window.addEventListener("blur",y,{once:!0}))}),{close:()=>A(o),element:o}}function R(e,t={}){G(e,s({tone:"danger"},t))}function B(e,t={}){G(e,s({tone:"success"},t))}function _(e,t={}){G(e,s({tone:"warning"},t))}function Q(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function g(e,t=M){var a=(null!=(a=Spicetify.SVGIcons)?a:{})[e];return a?`<span class="qs-btn-icon" data-icon-name="${Q(e)}"><svg class="qs-svg-icon" viewBox="0 0 16 16" aria-hidden="true" focusable="false" style="width:${t}px;height:${t}px;">${a}</svg></span>`:""}function U(e,t){var a=e.querySelector(".qs-btn-label");a?a.textContent=t:e.textContent=t}function Z(e,t){e=e.querySelector(".qs-btn-icon");e&&(t=g(t))&&(e.outerHTML=t)}function ee(){return Date.now()+"-"+Math.random().toString(36).slice(2,8)}function te(t,a){if(t.length!==a.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==a[e])return!1;return!0}async function ae(e,t){try{var a=JSON.stringify(t,null,2),n=new Blob([a],{type:"application/json"}),i=window;if(i&&"function"==typeof i.showSaveFilePicker)try{var s=await(await i.showSaveFilePicker({suggestedName:e,types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]})).createWritable();return await s.write(n),void await s.close()}catch(e){if(e&&("AbortError"===e.name||"NotAllowedError"===e.name))return void _(`Export canceled (${e.name})`)}var o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=e,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(o),B(`Exported ${e} to Downloads folder`)}catch(e){console.warn(P+": downloadJson failed",e),R("Failed to export JSON")}}async function ne(){try{var t=window;let e;if(t&&"function"==typeof t.showOpenFilePicker)try{var[a]=await t.showOpenFilePicker({multiple:!1,types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]}),n=await a.getFile();e=await n.text()}catch(e){if(e&&("AbortError"===e.name||"NotAllowedError"===e.name))return _(`Import canceled (${e.name})`),null}else{let n=document.createElement("input");n.type="file",n.accept=".json,application/json";var i=await new Promise(a=>{n.onchange=async()=>{var e;if(null!=(e=n.files)&&e.length)try{var t=await n.files[0].text();a(t)}catch(e){console.error(P+": file read failed",e),a(null)}else a(null)},n.click()});i&&(e=i)}return"string"!=typeof e?null:JSON.parse(e)}catch(e){return console.warn(P+": uploadJson failed",e),R("Failed to import JSON"),null}}async function ie(t){let a,i=new Array(t.length).fill(""),s=[],o=[];t.forEach((e,t)=>{var a,n;e.startsWith("spotify:local:")?i[t]=(t=>{var a=(t=t.split(":"))[2]||"Local",t=t[4]||"track";try{return decodeURIComponent(a.replace(/\+/g," "))+" - "+decodeURIComponent(t.replace(/\+/g," "))}catch(e){return a+" - "+t}})(e):({type:a,id:n}=(e=>{if(3<=(e=e.split(":")).length){if("track"===e[1])return{type:"track",id:e[2]};if("episode"===e[1])return{type:"episode",id:e[2]}}return{type:null,id:null}})(e),"track"===a&&n?s.push({idx:t,id:n}):"episode"===a&&n?o.push({idx:t,id:n}):i[t]=e)});for(let e=0;e<s.length;e+=50){var n=s.slice(e,e+50),r=n.map(e=>e.id).join(",");try{var l,d,c,u,p=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks?ids="+r),m=Array.isArray(null==p?void 0:p.tracks)?p.tracks:[],f=new Map;for(l of m)null!=l&&l.id&&null!=l&&l.name&&(c=(d=Array.isArray(null==l?void 0:l.artists)?l.artists.map(e=>null==e?void 0:e.name).filter(Boolean).join(", "):"")?d+" - "+l.name:l.name,f.set(l.id,c));for(u of n)i[u.idx]=f.get(u.id)||t[u.idx]}catch(e){for(var g of n)i[g.idx]=t[g.idx]}}if(o.length)for(let e=0;e<o.length;e+=50){var v=o.slice(e,e+50),y=v.map(e=>e.id).join(",");try{var h,b,x,q,w=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/episodes?ids="+y),E=Array.isArray(null==w?void 0:w.episodes)?w.episodes:[],S=new Map;for(h of E)null!=h&&h.id&&null!=h&&h.name&&(x=(b=null==(a=null==h?void 0:h.show)?void 0:a.name)?b+" - "+h.name:h.name,S.set(h.id,x));for(q of v)i[q.idx]=S.get(q.id)||t[q.idx]}catch(e){for(var k of v)i[k.idx]=t[k.idx]}}return i}function se(e){return("auto"===e.type?"Auto":"Manual")+" "+(t=>{try{return new Date(t).toLocaleString()}catch(e){return""+t}})(e.createdAt)}function oe(e){return e.name||se(e)}function re(e){return"string"==typeof e&&e.startsWith("spotify:")?e:e&&"string"==typeof e.uri&&e.uri.startsWith("spotify:")?e.uri:e&&e.contextTrack&&"string"==typeof e.contextTrack.uri&&e.contextTrack.uri.startsWith("spotify:")?e.contextTrack.uri:e&&e.track&&"string"==typeof e.track.uri&&e.track.uri.startsWith("spotify:")?e.track.uri:e&&e.item&&"string"==typeof e.item.uri&&e.item.uri.startsWith("spotify:")?e.item.uri:null}function le(){var t,a,n;try{var i,s=Spicetify.Queue,o=[],r=re(null==s?void 0:s.track)||re(null==(a=null==(t=Spicetify.Player)?void 0:t.data)?void 0:a.item),l=(r&&o.push(r),(null==s?void 0:s.nextTracks)||[]);let e=0;for(i of Array.isArray(l)?l:[]){var d,c=null==i?void 0:i.provider,u=(null==(n=null==i?void 0:i.contextTrack)?void 0:n.metadata)||(null==i?void 0:i.metadata),p=!0===(null==u?void 0:u.is_queued)||"true"===(null==u?void 0:u.is_queued);("queue"===c||p)&&(d=re(i))&&(o.push(d),e++)}var m=o.length?(e=>{var t,a=[];let n=null;for(t of e)t&&t!==n&&a.push(t),n=t;return a})(o):[];return console.log(P+": Spicetify.Queue -> now=%s queuedNext=%d total=%d",Boolean(r),e,m.length),m}catch(e){return console.error(P+": Spicetify.Queue read failed",e),[]}}function de(e){return"danger"===e||"primary"===e||"subtle"===e?e:"default"}function ce(){var e=document.createElement("div");return e.className="qs-confirm-backdrop",document.body.appendChild(e),e}function ue(e){var t=document.createElement("div");return t.className="qs-confirm-dialog",e.appendChild(t),t}function pe(e){if(q)return Promise.resolve("cancel");q=!0;let{title:m,message:f,confirmLabel:g="Confirm",cancelLabel:v="Cancel",tone:y="default",extraLabel:h,extraTone:b="subtle"}=e;return new Promise(t=>{let a=ce();var e=ue(a),n=(m&&((n=document.createElement("div")).className="qs-confirm-title",n.textContent=m,e.appendChild(n)),document.createElement("div")),n=(n.className="qs-confirm-message",n.textContent=f,e.appendChild(n),document.createElement("div")),i=(n.className="qs-confirm-actions",document.createElement("button"));i.type="button",i.className="qs-btn subtle",i.textContent=v;let s=document.createElement("button");s.type="button";var o=de(y),r=["qs-btn"];r.push("default"!==o?o:"primary"),s.className=r.join(" "),s.textContent=g;let l=null,d=(h&&((l=document.createElement("button")).type="button",o=de(b),(r=["qs-btn"]).push("default"!==o?o:"primary"),l.className=r.join(" "),l.textContent=h),l?n.append(i,l,s):n.append(i,s),e.appendChild(n),document.activeElement),c=!1;function u(e){c||(c=!0,a.remove(),null!=d&&d.focus&&d.focus(),document.removeEventListener("keydown",p,!0),q=!1,t(e))}function p(e){"Escape"===e.key?(e.preventDefault(),u("cancel")):"Enter"===e.key&&document.activeElement===s&&(e.preventDefault(),u("confirm"))}i.addEventListener("click",()=>u("cancel")),s.addEventListener("click",()=>u("confirm")),l&&l.addEventListener("click",()=>u("extra")),a.addEventListener("click",e=>{e.target===a&&u("cancel")}),document.addEventListener("keydown",p,!0),setTimeout(()=>{s.focus()},0)})}async function me(){var e,t;try{var a,n,i=await le();i.length?null!==(n=null!=(t=null==(e=await(e=>{if(q)return Promise.resolve(null);q=!0;let{title:f,message:g,confirmLabel:v="Confirm",cancelLabel:y="Cancel",tone:h="default",defaultValue:b="",placeholder:x}=e;return new Promise(t=>{let a=ce();var e=ue(a);f&&((i=document.createElement("div")).className="qs-confirm-title",i.textContent=f,e.appendChild(i)),g&&((i=document.createElement("div")).className="qs-confirm-message",i.textContent=g,e.appendChild(i));let n=document.createElement("input");n.type="text",n.className="qs-dialog-input",n.value=b,x&&(n.placeholder=x),e.appendChild(n);var i=document.createElement("div"),s=(i.className="qs-confirm-actions",document.createElement("button")),o=(s.type="button",s.className="qs-btn subtle",s.textContent=y,document.createElement("button")),r=(o.type="button",de(h)),l=["qs-btn"];l.push("default"!==r?r:"primary"),o.className=l.join(" "),o.textContent=v,i.append(s,o),e.appendChild(i);let d=document.activeElement,c=!1;function u(e){c||(c=!0,a.remove(),n.removeEventListener("keydown",p),document.removeEventListener("keydown",m,!0),null!=d&&d.focus&&d.focus(),q=!1,t(e))}function p(e){"Enter"===e.key?(e.preventDefault(),u(n.value)):"Escape"===e.key&&(e.preventDefault(),u(null))}function m(e){"Escape"===e.key&&(e.preventDefault(),u(null))}s.addEventListener("click",()=>u(null)),o.addEventListener("click",()=>u(n.value)),n.addEventListener("keydown",p),document.addEventListener("keydown",m,!0),a.addEventListener("click",e=>{e.target===a&&u(null)}),setTimeout(()=>{n.focus(),n.select()},0)})})({title:"Save snapshot",message:"Name this snapshot",confirmLabel:"Save",cancelLabel:"Cancel",defaultValue:a=se({type:"manual",createdAt:Date.now()})}))?void 0:e.trim())?t:null)&&(""===n?R("Snapshot not saved (name cannot be empty)"):(T({id:ee(),createdAt:Date.now(),name:n===a?void 0:n,type:"manual",items:i}),B("Snapshot saved"))):_("No queue found. If you believe this is an error, please try to play and pause a track.")}catch(e){console.error(P+": manual snapshot failed",e),R("Failed to save snapshot")}}function fe(e){return e&&"string"==typeof e.id&&"number"==typeof e.createdAt&&("auto"===e.type||"manual"===e.type)&&Array.isArray(e.items)&&e.items.every(e=>"string"==typeof e)}function J(t){Array.from(F.keys()).forEach(e=>{e!==t&&ge(e)})}function ge(e){var t=F.get(e);t&&(t.input.removeEventListener("keydown",t.onKeyDown),t.input.removeEventListener("blur",t.onBlur),t.input.isConnected&&t.input.remove(),t.labelEl.style.display="",t.labelEl.textContent=t.originalLabel,t.actionsEl&&(t.actionsEl.style.display=null!=(t=t.originalActionsDisplay)?t:""),F.delete(e))}function v(e,t,a={}){var{action:a,id:n,tone:i="default",title:s}=a,o=["qs-btn"],i=("danger"===i&&o.push("danger"),"primary"===i&&o.push("primary"),"subtle"===i&&o.push("subtle"),[]),a=(a&&i.push(`data-action="${a}"`),n&&i.push(`id="${n}"`),s&&i.push(`title="${Q(s)}"`),i.length?" "+i.join(" "):""),n=g(t);return`<button type="button" class="${o.join(" ")}"${a}>${n}<span class="qs-btn-label">${Q(e)}</span></button>`}function ve(e,t,a,n={}){var{tone:n="default"}=n,i=["qs-icon-btn"];return"danger"===n&&i.push("danger"),`<button type="button" class="${i.join(" ")}" data-action="${Q(e)}" title="${Q(a)}">${g(t)}</button>`}function y(e,t="default"){var a=["qs-pill"];return"default"!==t&&a.push({accent:"qs-pill--accent",version:"qs-pill--version",channel:"qs-pill--channel"}[t]),`<span class="${a.join(" ")}">${Q(e)}</span>`}function ye(e){return e.map(e=>{var t=Q(oe(e)),a=e.items.some(e=>e.startsWith("spotify:local:")),n=[y(e.items.length+" "+(1===e.items.length?"item":"items"),"accent")],a=(a&&n.push(y("includes local")),n.join(""));return`
          <div class="qs-row" data-id="${e.id}">
            <div class="qs-row-main">
              <div class="qs-row-title">
                ${g("auto"===e.type?"clock":"playlist")}
                <span>${t}</span>
                <span class="qs-title-actions">
                  ${ve("rename","edit","Rename snapshot")}
                  ${e.name?ve("reset-name","repeat","Reset name"):""}
                  ${ve("delete","x","Delete snapshot",{tone:"danger"})}
                </span>
              </div>
              <div class="qs-row-meta">${a}</div>
              <div class="qs-row-actions">
                ${v("View","chevron-right",{action:"toggle-items",title:"Toggle items"})}
                ${v("Replace queue","skip-forward",{action:"replace-queue",title:"Replace queue",tone:"primary"})}
                ${v("Append to queue","plus-alt",{action:"append-queue",title:"Append to queue"})}
                ${v("Export","download",{action:"export",title:"Export to playlist"})}
              </div>
            </div>
          </div>
          <div class="qs-items" data-id="${e.id}" style="display:none">
            <div class="qs-items-body">Loading…</div>
          </div>
        `}).join("")}function he(){var e=p(),t=e.filter(e=>"auto"===e.type),e=e.filter(e=>"manual"===e.type),a=ye(t),n=ye(e);return`
      <div class="qs-section-card">
        <div class="qs-section-head">
          <div class="qs-section-heading">
            ${g("playlist")}
            <div class="qs-section-text">
              <div class="qs-section-name">Manual Snapshots</div>
              <div class="qs-section-caption">Your saved queues for later</div>
            </div>
            ${y(String(e.length),"accent")}
          </div>
          <div class="qs-actions">
            ${v("Export all","download",{id:"qs-export-manuals",tone:"subtle"})}
            ${v("Save now","plus-alt",{id:"qs-new-manual",tone:"primary"})}
          </div>
        </div>
        <div class="qs-section-body">
          ${n||'<div class="qs-empty">No manual snapshots yet</div>'}
        </div>
      </div>
      <div class="qs-section-card">
        <div class="qs-section-head">
          <div class="qs-section-heading">
            ${g("clock")}
            <div class="qs-section-text">
              <div class="qs-section-name">Automatic Snapshots</div>
              <div class="qs-section-caption">Captured in the background</div>
            </div>
            ${y(String(t.length),"accent")}
          </div>
          <div class="qs-actions">
            ${v("Export all","download",{id:"qs-export-autos",tone:"subtle"})}
          </div>
        </div>
        <div class="qs-section-body">
          ${a||'<div class="qs-empty">No automatic snapshots yet</div>'}
        </div>
      </div>
    `}function be(e){return`
        <div class="qs-settings">
          <div class="qs-settings-header">
            <div class="qs-section-heading">
              ${g("grid-view")}
              <div class="qs-section-text">
                <div class="qs-section-name">Settings</div>
                <div class="qs-section-caption">Tune automation and queue alerts</div>
              </div>
            </div>
          </div>
          <div class="qs-setting">
              <label class="qs-checkbox"><input type="checkbox" id="qs-auto-enabled" ${e.autoEnabled?"checked":""}/> ${g("brightness")}Enable automatic snapshots</label>
            <div class="qs-dim">Mode 
              <div class="qs-radio-group" id="qs-auto-mode-group">
                <label class="qs-radio-label"><input type="radio" class="qs-radio" name="qs-auto-mode" value="timer" ${"timer"===e.autoMode?"checked":""} ${e.autoEnabled?"":"disabled"}/><span>${g("clock")} Time-based</span></label>
                <label class="qs-radio-label"><input type="radio" class="qs-radio" name="qs-auto-mode" value="on-change" ${"on-change"===e.autoMode?"checked":""} ${e.autoEnabled?"":"disabled"}/><span>${g("shuffle")} Queue changes</span><span class="qs-icon"><span class="qs-icon-glyph">ⓘ</span><span class="qs-tooltip"><span class="qs-tooltip-emph">Experimental!</span>This mode may create many similar snapshots (for example when queuing a bunch of songs)</span></span></label>
              </div>
            </div>
            <div class="qs-setting" style="margin-top:6px">
              <label class="qs-checkbox"><input type="checkbox" id="qs-only-new" ${e.onlyNewItems?"checked":""} ${e.autoEnabled?"":"disabled"}/> ${g("search")} Check for new items</label>
              <div style="opacity:0.7; font-size:12px">Only trigger it when there is a new song that was not in the previous snapshot.</div>
            </div>
            <div class="qs-setting" style="margin-top:6px">
              <div style="opacity:0.7; font-size:12px">Equal queues are never saved as automatic snapshots.</div>
            </div>
            <div class="qs-setting" style="margin-top:12px">
              <label class="qs-checkbox"><input type="checkbox" id="qs-queue-warn-enabled" ${e.queueWarnEnabled?"checked":""}/> ${g("exclamation-circle")} Warn when queue is nearly full</label>
              <div style="opacity:0.7; font-size:12px">Heuristic limit; includes current track. Adjust if needed.</div>
            </div>
            <div class="qs-setting" style="margin-top:12px">
              <label class="qs-checkbox"><input type="checkbox" id="qs-prompt-manual-before-replace" ${e.promptManualBeforeReplace?"checked":""}/> ${g("copy")} Ask to save manual snapshot before replacing queue</label>
              <div style="opacity:0.7; font-size:12px">Offers to store the current queue before overwriting it.</div>
            </div>
          </div>
          <div class="qs-right">
            <div class="qs-setting">
              <label>${g("clock")} Interval (minutes)</label>
              <input class="qs-input" type="number" id="qs-auto-interval-mins" min="0.5" step="0.5" value="${(e.autoIntervalMs/6e4).toFixed(2)}" ${e.autoEnabled&&"timer"===e.autoMode?"":"disabled"} />
              <div style="opacity:0.7; font-size:12px">Minimum 0.5 (30 seconds)</div>
            </div>
            <div class="qs-setting">
              <label>${g("chart-up")} Max automatic snapshots</label>
              <input class="qs-input" type="number" id="qs-max-autos" min="1" step="1" value="${e.maxAutosnapshots}" ${e.autoEnabled?"":"disabled"} />
              <div style="opacity:0.7; font-size:12px">Older snapshots are pruned. Be careful when changing this</div>
            </div>
            <div class="qs-setting">
              <label>${g("queue")} Queue max size</label>
              <input class="qs-input" type="number" id="qs-queue-max-size" min="10" step="1" value="${e.queueMaxSize}" ${e.queueWarnEnabled?"":"disabled"} />
            </div>
            <div class="qs-setting">
              <label>${g("exclamation-circle")} Warn when remaining slots ≤</label>
              <input class="qs-input" type="number" id="qs-queue-warn-threshold" min="0" step="1" value="${e.queueWarnThreshold}" ${e.queueWarnEnabled?"":"disabled"} />
            </div>
          </div>
        </div>
    `}function xe(e){var t=document.querySelector(".qs-settings");t&&(t.outerHTML=be(e.getSettings()))}function qe(C){var e=y("v"+I,"version"),t=d?y(d.toUpperCase(),"channel"):"",a=he(),n=be(C.getSettings()),e=`
      <div class="qs-container">
        <div class="qs-header">
          <div class="qs-header-title">
            <div class="qs-header-icon">${g("queue",20)}</div>
            <span class="qs-header-badges">${e}${t}</span>
          </div>
          <div class="qs-actions">
            ${v("Refresh","repeat",{id:"qs-refresh",tone:"subtle"})}
            ${v("Export settings","download",{id:"qs-export-settings",title:"Export settings to a JSON file"})}
            ${v("Import snapshots","chart-up",{id:"qs-import-snapshots",title:"Import snapshots from a JSON file"})}
            ${v("Import settings","chart-up",{id:"qs-import-settings",title:"Import settings from a JSON file"})}
          </div>
        </div>
        ${n}
        <div id="qs-list">
          ${a||'<div style="opacity:0.7">No snapshots yet</div>'}
        </div>
      </div>
    `;function i(){let t=C.getSettings();var e=document.querySelectorAll('input.qs-radio[name="qs-auto-mode"]'),a=document.querySelector("#qs-auto-interval-mins"),n=document.querySelector("#qs-only-new"),i=document.querySelector("#qs-max-autos"),s=document.querySelector("#qs-queue-max-size"),o=document.querySelector("#qs-queue-warn-threshold"),e=(e.forEach(e=>{e.disabled=!t.autoEnabled}),a&&(a.disabled=!(t.autoEnabled&&"timer"===t.autoMode)),n&&(n.disabled=!t.autoEnabled),i&&(i.disabled=!t.autoEnabled),t.queueWarnEnabled);s&&(s.disabled=!e),o&&(o.disabled=!e)}Spicetify.PopupModal.display({title:P,content:e,isLarge:!0}),c&&(document.removeEventListener("click",c,!0),c=null),u&&(document.removeEventListener("change",u,!0),u=null),c=async function(e){var a=document.querySelector(".qs-container"),n=e.target;if(a&&n&&a.contains(n)&&e.stopPropagation(),a&&n){var t,i,s,a=W(),n=n.closest(".qs-btn, .qs-icon-btn");if("qs-new-manual"===(null==n?void 0:n.id))e.preventDefault(),J(),await me(),X();else{if("qs-export-settings"===(null==n?void 0:n.id))return e.preventDefault(),t=C.getSettings(),ae(D+"-settings.json",t);if("qs-import-settings"===(null==n?void 0:n.id))e.preventDefault(),t=C,(s=await ne())&&(!(i=s)||"boolean"!=typeof i.autoEnabled||"number"!=typeof i.autoIntervalMs||"number"!=typeof i.maxAutosnapshots||"timer"!==i.autoMode&&"on-change"!==i.autoMode||"boolean"!=typeof i.onlyNewItems||"boolean"!=typeof i.queueWarnEnabled||"number"!=typeof i.queueMaxSize||"number"!=typeof i.queueWarnThreshold||"boolean"!=typeof i.promptManualBeforeReplace?R("Invalid settings file format."):"confirm"===await pe({title:"Import Settings",message:"This will overwrite your current settings. Are you sure?",confirmLabel:"Import",tone:"danger"})&&(t.setSettings(s),xe(t),B("Settings imported successfully.")));else{if("qs-import-snapshots"===(null==n?void 0:n.id))return e.preventDefault(),(async()=>{if(e=await ne()){var e=Array.isArray(e)?e:[e],a=e.filter(fe);if(a.length!==e.length&&R("Some imported snapshots were invalid and have been skipped."),a.length){e=W();let t=new Set(e.map(e=>e.id));a=a.filter(e=>!t.has(e.id));a.length?(O([...e,...a]),X(),B(`Imported ${a.length} new ${1===a.length?"snapshot":"snapshots"}.`)):B("All snapshots already exist.")}else R("No valid snapshots to import.")}})();if("qs-export-manuals"===(null==n?void 0:n.id))return e.preventDefault(),i=a.filter(e=>"manual"===e.type),ae(D+"-manual-snapshots.json",i);if("qs-export-autos"===(null==n?void 0:n.id))return e.preventDefault(),s=a.filter(e=>"auto"===e.type),ae(D+"-auto-snapshots.json",s);if("qs-refresh"===(null==n?void 0:n.id))e.preventDefault(),xe(C),X();else if(n){var o=n.closest(".qs-row"),r=n.getAttribute("data-action"),l=n.classList.contains("qs-icon-btn");if(o&&(r||!l)){let t=o.getAttribute("data-id");if(t){F.has(t)||J(t);var d=a.find(e=>e.id===t);if(d){if(l)return"rename"===r?(e.preventDefault(),void function i(s,o){if(s.isConnected){let n=o.id;if(F.has(n))(a=F.get(n))&&(a.input.focus(),a.input.select());else{var a=s.querySelector(".qs-row-title");if(a){var r=Array.from(a.querySelectorAll("span"))[1];if(r){var l=null!=(l=a.querySelector(".qs-title-actions"))?l:void 0,d=null!=(d=r.textContent)?d:"",c=se(o),u=null!=(u=null==l?void 0:l.style.display)?u:"";let e=document.createElement("input"),t=(e.type="text",e.value=null!=(p=o.name)?p:d,e.className="qs-inline-input",e.setAttribute("aria-label","Snapshot name"),r.style.display="none",l&&(l.style.display="none"),a.insertBefore(e,null!=l?l:null),e=>{var t,a=F.get(n);a&&(ge(n),e)&&((e=a.input.value.trim())?e!==a.originalLabel.trim()&&(e===a.generatedName?R("Name must differ from the default suggestion",{duration:2e3}):0<=(t=(a=W()).findIndex(e=>e.id===n))&&(a[t].name=e,O(a),X())):(R("Name cannot be empty",{duration:2e3}),i(s,o)))});var p={input:e,labelEl:r,originalLabel:d,actionsEl:l,originalActionsDisplay:u,generatedName:c,onKeyDown(e){"Enter"===e.key?(e.preventDefault(),t(!0)):"Escape"===e.key&&(e.preventDefault(),t(!1))},onBlur(){t(!0)}};F.set(n,p),e.addEventListener("keydown",p.onKeyDown),e.addEventListener("blur",p.onBlur),setTimeout(()=>{e.focus(),e.select()},0)}}}}}(o,d)):"reset-name"===r?(e.preventDefault(),void(0<=(l=a.findIndex(e=>e.id===t))&&(delete a[l].name,O(a),X()))):"delete"!==r||"confirm"!==await pe({title:"Delete snapshot",message:"Delete this snapshot? This cannot be undone.",confirmLabel:"Delete",tone:"danger"})?void 0:(e=oe(d),O(a.filter(e=>e.id!==t)),X(),void B("Snapshot deleted: "+e));var c,u,l=r;if(l)if("toggle-items"===l){a=o.nextElementSibling,e=n;if(a&&a.classList.contains("qs-items"))if("none"===a.style.display||!a.style.display){a.style.display="block",U(e,"Hide"),Z(e,"chart-down");r=a.querySelector(".qs-items-body");if(r){r.textContent="Loading…";try{c=d;var p=await(j.has(c.id)?j.get(c.id):(u=await ie(c.items),j.set(c.id,u),u));r.innerHTML=p.map((e,t)=>`<div>${t+1}. ${Q(e)}</div>`).join("")}catch(e){r.textContent="Failed to load items"}}}else a.style.display="none",U(e,"View"),Z(e,"chevron-right")}else if("export"===l){if(!z.has(t)){z.add(t);var m=d,o=n;try{if(m.items.length){o&&(o.disabled=!0,U(o,"Exporting…"));var f=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/me"),g=null==f?void 0:f.id;if(!g)throw new Error("No user id");var v=oe(m),y=await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/users/${encodeURIComponent(g)}/playlists`,{name:v,description:`Saved from ${P} on `+new Date(m.createdAt).toLocaleString(),public:!1}),h=null==y?void 0:y.id;if(!h)throw new Error("Playlist creation failed");var b="spotify:playlist:"+h;let t=0;var x=m.items.length;for(let e=0;e<m.items.length;e+=100){var q=m.items.slice(e,e+100);try{await Spicetify.Platform.PlaylistAPI.add(b,q,{after:"end"}),t+=q.length}catch(e){console.warn(P+": failed to add a chunk",e)}}if(t===x){B("Exported to "+v);try{var w=Spicetify.URI.playlistV2URI(h),E=null==w?void 0:w.toURLPath(!0),S=Spicetify.Platform.History;if(E)if(null!=S&&S.push)try{S.push(E)}catch(e){S.push({pathname:E})}else window.location.hash=E}catch(e){}}else _(`Exported; some tracks couldn't be added (${t}/${x})`);try{console.log(P+": Export result",{snapshotId:m.id,totalExpected:x,totalAdded:t})}catch(e){}}else _("Nothing to export")}catch(e){console.error(P+": export failed",e),R("Failed to export to playlist")}finally{o&&(o.disabled=!1,U(o,"Export"))}await 0,z.delete(t)}}else if("append-queue"===l){if(!z.has(t)){z.add(t);try{var k=d,L=n;try{if(k.items.length){L&&(L.disabled=!0,U(L,"Appending…"));var $=k.items.slice();let t=0;for(let e=0;e<$.length;e+=100){var A=$.slice(e,e+100),I=A.map(e=>({uri:e}));try{await Spicetify.Platform.PlayerAPI.addToQueue(I),t+=I.length}catch(e){console.warn(P+": addToQueue chunk failed",e);for(var M of A)try{await Spicetify.Platform.PlayerAPI.addToQueue([{uri:M}]),t+=1}catch(e){console.warn(P+": addToQueue single failed",{uri:M,error:e})}}}var N=$.length;t===N?B(`Added ${N} ${1===N?"item":"items"} to queue`):0<t?_(`Added ${t}/${N} items to queue`):R("Failed to queue snapshot items");try{console.log(P+": Append result",{snapshotId:k.id,totalExpected:N,added:t})}catch(e){}}else _("Snapshot is empty")}catch(e){console.error(P+": append queue failed",e),R("Failed to append to queue")}finally{L&&(L.disabled=!1,U(L,"Append to queue"))}await 0}finally{z.delete(t)}}}else if("replace-queue"===l&&!z.has(t)){z.add(t);try{if(C.getSettings().promptManualBeforeReplace){var T=await pe({title:"Save current queue?",message:"Create a manual snapshot of the current queue before replacing it?",confirmLabel:"Save snapshot",cancelLabel:"Skip",extraLabel:"Cancel",extraTone:"danger",tone:"primary"});if("extra"===T)return;"confirm"===T&&(await me(),X())}await(async(e,a)=>{try{if(e.items.length){a&&(a.disabled=!0,U(a,"Replacing…"));var n=e.items.slice(),i=n.shift();try{await Spicetify.Platform.PlayerAPI.clearQueue()}catch(e){console.warn(P+": clearQueue failed (non-fatal)",e)}if(i.startsWith("spotify:local:"))try{await Spicetify.Platform.PlayerAPI.play({uri:"spotify:internal:local-files",pages:[{items:[{uri:i}]}]},{},{skipTo:{index:0}})}catch(e){return console.warn(P+": local fallback failed",e),void R("Failed to start playback")}else try{await Spicetify.Player.playUri(i)}catch(e){try{await Spicetify.Platform.PlayerAPI.play({uri:i},{},{})}catch(e){return console.warn(P+": failed to start first track",e),void R("Failed to start playback")}}await new Promise(e=>setTimeout(e,250));let t=0;for(let e=0;e<n.length;e+=100){var s=n.slice(e,e+100).map(e=>({uri:e}));try{await Spicetify.Platform.PlayerAPI.addToQueue(s),t+=s.length}catch(e){console.warn(P+": addToQueue chunk failed",e)}}t===n.length?B(`Queue replaced (${e.items.length} items)`):_(`Replaced; some items couldn't be queued (${t+1}/${e.items.length})`)}else _("Snapshot is empty")}catch(e){console.error(P+": replace queue failed",e),R("Failed to replace queue")}finally{a&&(a.disabled=!1,U(a,"Replace queue"))}})(d,n)}finally{z.delete(t)}}}}}}}}}},u=function(e){var t,a=document.querySelector(".qs-container"),n=e.target;a&&n&&a.contains(n)&&(e.stopPropagation(),"qs-auto-enabled"===n.id?(a=!!n.checked,e=C.getSettings(),e=o(s({},e),{autoEnabled:a}),C.setSettings(e),J(),i()):"qs-auto-mode"===n.name?(a=n,e=C.getSettings(),a="on-change"===a.value?"on-change":"timer",e=o(s({},e),{autoMode:a}),C.setSettings(e),i()):"qs-only-new"===n.id?(a=!!n.checked,e=C.getSettings(),e=o(s({},e),{onlyNewItems:a}),C.setSettings(e)):"qs-auto-interval-mins"===n.id?(a=n,e=C.getSettings(),a=parseFloat(a.value),a=isFinite(a)&&.5<=a?a:e.autoIntervalMs/6e4,e=o(s({},e),{autoIntervalMs:Math.round(6e4*a)}),C.setSettings(e)):"qs-max-autos"===n.id?(a=n,e=C.getSettings(),a=parseInt(a.value,10),a=Number.isFinite(a)&&0<a?a:e.maxAutosnapshots,e=o(s({},e),{maxAutosnapshots:a}),C.setSettings(e),a=e,t=(e=p()).filter(e=>"manual"===e.type),e=e.filter(e=>"auto"===e.type).slice(0,a.maxAutosnapshots),O([...t,...e]),X()):"qs-queue-warn-enabled"===n.id?(a=n.checked,t=C.getSettings(),e=o(s({},t),{queueWarnEnabled:a}),C.setSettings(e),i()):"qs-queue-max-size"===n.id?(a=n,e=C.getSettings(),a=parseInt(a.value,10),a=Number.isFinite(a)&&1<a?a:e.queueMaxSize,e=o(s({},e),{queueMaxSize:a}),C.setSettings(e)):"qs-queue-warn-threshold"===n.id?(a=n,e=C.getSettings(),a=parseInt(a.value,10),a=Number.isFinite(a)&&0<=a?a:e.queueWarnThreshold,e=o(s({},e),{queueWarnThreshold:a}),C.setSettings(e)):"qs-prompt-manual-before-replace"===n.id&&(a=n.checked,e=C.getSettings(),n=o(s({},e),{promptManualBeforeReplace:a}),C.setSettings(n)))},document.addEventListener("click",c,!0),document.addEventListener("change",u,!0),i()}function X(){J();var e,t=document.getElementById("qs-list");t&&(e=he(),t.innerHTML=e||'<div style="opacity:0.7">No snapshots yet</div>')}function we(){let n=[],t=null,s=[],o=null,r=null;function l(){null!==t&&(clearInterval(t),t=null)}async function d(e){try{if(e.autoEnabled){let a=await le();if(a.length){if(e.onlyNewItems){let t=new Set(n);if(!a.some(e=>!t.has(e)))return void(n=a)}n=(te(a,n)||W().filter(e=>"auto"===e.type).some(e=>te(e.items,a))||T({id:ee(),createdAt:Date.now(),type:"auto",items:a},e),a)}else console.log(P+": queue is empty, skipping auto snapshot")}}catch(e){console.error(P+": auto snapshot error",e),R("Failed to save an automatic snapshot")}}function c(e){l(),e.autoEnabled&&(t=window.setInterval(()=>d(e),e.autoIntervalMs),r=e.autoIntervalMs)}function u(){for(var e of s)e();s=[]}return{startAutoTimer:c,primeFromExisting:function(){var e,t=p()[0];null!=(e=null==t?void 0:t.items)&&e.length&&(n=t.items.slice())},applyAutoMode:function(e){var t=e.autoEnabled?e.autoMode:null;if(t===o)"timer"===t&&r!==e.autoIntervalMs&&c(e);else{if("on-change"===o?u():"timer"===o&&l(),"on-change"===t){var a,n,i=e;if(u(),i.autoEnabled)try{let e=null==(n=null==(a=null==Spicetify?void 0:Spicetify.Player)?void 0:a.origin)?void 0:n._events;if(null==e||!e.addListener||null==e||!e.removeListener)throw new Error("queue_update events API not available");let t=e=>{d(i),console.log(P+": queue_update",e)};e.addListener("queue_update",t),s.push(()=>{try{e.removeListener("queue_update",t)}catch(e){console.error(P+": failed to remove queue_update listener",e)}})}catch(e){console.error(P+": failed to start queue update watcher",e),R("Failed to start queue update watcher")}}else"timer"===t&&c(e);o=t}}}}function Ee(o){let i=null,r=null,l=0,d=3e4;async function s(){try{var e,t,a,n,i,s=o();s.queueWarnEnabled&&(e=s.queueMaxSize,(t=s.queueWarnThreshold)<0||e<=1||(a=await le()).length&&(n=Math.max(0,e-a.length))<=t&&(i=Date.now(),r!==n||i-l>=d)&&(_(`Queue nearly full (${e-n}/${e})`,{duration:25e4,id:"queue-nearly-full"}),r=n,l=i))}catch(e){console.warn(P+": queue capacity check failed",e)}}function e(){if(i){try{i()}catch(e){}i=null}}return{start:function(){var a,n;e();try{let e=null==(n=null==(a=null==Spicetify?void 0:Spicetify.Player)?void 0:a.origin)?void 0:n._events;if(null==e||!e.addListener||null==e||!e.removeListener)throw new Error("queue_update events API not available");let t=e=>{s()};e.addListener("queue_update",t),i=()=>{try{e.removeListener("queue_update",t)}catch(e){console.error(P+": failed to remove queue_update listener (capacity watcher)",e)}},s()}catch(e){console.error(P+": failed to start capacity watcher",e),R("Failed to start capacity watcher")}},stop:e,checkAndWarnOnce:s}}h=Object.defineProperty,b=Object.defineProperties,x=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,i=(e,t,a)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,s=(e,t)=>{for(var a in t=t||{})w.call(t,a)&&i(e,a,t[a]);if(n)for(var a of n(t))E.call(t,a)&&i(e,a,t[a]);return e},l={autoEnabled:!(r="queue-manager:settings"),autoIntervalMs:3e5,maxAutosnapshots:20,autoMode:"timer",onlyNewItems:!0,queueWarnEnabled:!0,queueMaxSize:80,queueWarnThreshold:5,promptManualBeforeReplace:!(o=(e,t)=>b(e,x(t)))},a="queue-manager:snapshots",P="Queue Manager",D="queue-manager",I="0.5.1",d="beta",S=null,k=new Map,M=16,j=new Map,q=!1,u=c=null,z=new Set,F=new Map,e=async function(){for(var e;null==Spicetify||!Spicetify.showNotification||null==Spicetify||!Spicetify.CosmosAsync||null==Spicetify||!Spicetify.LocalStorage;)await new Promise(e=>setTimeout(e,100));let t=N(),a=we(),n=(a.primeFromExisting(),a.applyAutoMode(t),Ee(()=>t)),i=(n.start(),{getSettings:()=>t,setSettings:e=>{t=e,Spicetify.LocalStorage.set(r,JSON.stringify(e)),a.applyAutoMode(e),n.checkAndWarnOnce()}});try{null!=(e=null==Spicetify?void 0:Spicetify.Topbar)&&e.Button&&new Spicetify.Topbar.Button(P,"queue",()=>qe(i),void 0,!0)}catch(e){console.error(P+": failed to add topbar button")}try{new Spicetify.ContextMenu.Item(P,()=>qe(i),(e,t,a)=>{var n,i,s;try{if(a){var o=Spicetify.URI.fromString(a);if((null==o?void 0:o.type)===Spicetify.URI.Type.QUEUE)return!0;if(a.includes(":queue"))return!0}return((null==(s=null==(i=null==(n=Spicetify.Platform)?void 0:n.History)?void 0:i.location)?void 0:s.pathname)||"").includes("queue")}catch(e){}return!1},"queue").register()}catch(e){console.error(P+": failed to add context menu item")}try{Spicetify.Keyboard.registerShortcut({key:"q",ctrl:!0,alt:!0},()=>qe(i))}catch(e){console.error(P+": failed to add keyboard shortcut")}},(async()=>{await e()})(),(async()=>{var e;document.getElementById("queueDmanager")||((e=document.createElement("style")).id="queueDmanager",e.textContent=String.raw`
  .qs-container{display:flex;flex-direction:column;gap:18px;overflow:visible}.qs-header{display:flex;justify-content:space-between;align-items:center;padding:16px;border-radius:12px;background:linear-gradient(135deg,rgba(52,211,153,.16),rgba(37,99,235,.12));border:1px solid rgba(255,255,255,.06);gap:12px}.qs-header-title{display:flex;align-items:center;gap:12px;font-weight:600}.qs-header-text{display:flex;flex-direction:column;gap:4px}.qs-header-app{display:flex;align-items:center;gap:10px}.qs-header-badges{display:inline-flex;gap:6px;align-items:center}.qs-header-icon{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,.4)}.qs-header-name{font-size:18px}.qs-header-sub,.qs-header-sub-alt{font-size:13px;opacity:.75}.qs-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}.qs-settings{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px;padding:16px;border-radius:12px;background:var(--spice-section-bg,rgba(255,255,255,.05));border:1px solid rgba(255,255,255,.05);overflow:visible}.qs-settings-header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}.qs-right{display:flex;flex-direction:column;gap:16px}.qs-setting{display:flex;flex-direction:column;gap:6px}.qs-setting label{font-weight:600;display:inline-flex;align-items:center;gap:8px}.qs-dim{color:rgba(255,255,255,.7);font-size:12px}.qs-row{display:flex;flex-direction:column;gap:12px;padding:12px 16px;border-radius:10px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.04);box-shadow:0 10px 30px rgba(0,0,0,.25)}.qs-row+.qs-row{margin-top:12px}.qs-row-main{display:flex;flex-direction:column;gap:10px}.qs-row-title{font-weight:600;display:inline-flex;align-items:center;gap:8px}.qs-title-actions{display:inline-flex;align-items:center;gap:6px;margin-left:8px}.qs-icon-btn{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:50%;background:0 0;border:1px solid transparent;cursor:pointer;padding:0;transition:background .15s ease,transform .12s ease,border .12s ease;color:inherit}.qs-icon-btn:hover{background:linear-gradient(135deg,rgba(96,165,250,.35),rgba(59,130,246,.2));border-color:rgba(96,165,250,.4);transform:translateY(-1px)}.qs-icon-btn:focus-visible{outline:2px solid rgba(96,165,250,.8);outline-offset:2px}.qs-icon-btn.danger{color:rgba(248,113,113,.85)}.qs-icon-btn.danger:hover{background:rgba(248,113,113,.16);border-color:rgba(248,113,113,.25);color:#f87171}.qs-icon-btn .qs-svg-icon{width:16px;height:16px}.qs-row-meta{display:flex;flex-wrap:wrap;gap:6px;font-size:12px;align-items:center}.qs-row-actions{display:flex;flex-wrap:nowrap;gap:10px;padding:2px 0;overflow-x:auto}.qs-row-actions .qs-btn{flex:0 0 auto;justify-content:flex-start}.qs-btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.08);color:inherit;border:1px solid transparent;cursor:pointer;font-weight:600;transition:transform .12s ease,box-shadow .12s ease,border .12s ease;text-decoration:none}.qs-btn.primary{background:linear-gradient(135deg,rgba(96,165,250,.9),rgba(59,130,246,.9));border-color:rgba(96,165,250,.35)}.qs-btn.subtle{background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.08)}.qs-btn.danger{background:rgba(248,113,113,.16);border-color:rgba(248,113,113,.25)}.qs-btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.25)}.qs-btn:focus-visible{outline:2px solid rgba(96,165,250,.8);outline-offset:2px}.qs-btn-icon{display:inline-flex;align-items:center;justify-content:center}.qs-btn-label{white-space:nowrap}.qs-svg-icon{display:block;fill:currentColor;width:16px;height:16px}.qs-section-card{display:flex;flex-direction:column;gap:12px;padding:16px;border-radius:12px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.05)}.qs-section-head{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center}.qs-section-heading{display:inline-flex;align-items:center;gap:12px;font-weight:600}.qs-section-text{display:flex;flex-direction:column;gap:2px}.qs-section-name{font-size:16px}.qs-section-caption{font-size:12px;opacity:.75}.qs-section-body{display:flex;flex-direction:column}.qs-empty{opacity:.6;font-size:13px;padding:12px}.qs-input{padding:8px 10px;border-radius:8px;background:rgba(0,0,0,.25);color:inherit;border:1px solid rgba(255,255,255,.1);font-size:14px}.qs-input:disabled{opacity:.6;cursor:not-allowed}.qs-checkbox{display:inline-flex;align-items:center;gap:10px}.qs-radio-group{display:inline-flex;gap:12px;align-items:center;margin-top:6px}.qs-radio-label span{display:inline-flex;align-items:center;gap:6px}.qs-icon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;font-size:12px;line-height:16px;margin-left:2px;position:relative}.qs-icon-glyph{opacity:.7;transition:opacity .12s ease-in-out}.qs-icon:hover .qs-icon-glyph{opacity:1}.qs-icon>.qs-tooltip{position:absolute;left:50%;transform:translateX(-50%);bottom:calc(100% + 6px);white-space:nowrap;text-align:left;padding:8px 10px;border-radius:4px;font-size:12px;background:#121212;border:1px solid rgba(255,255,255,.08);box-shadow:0 4px 14px rgba(0,0,0,.35);color:var(--spice-text,#fff);pointer-events:none;opacity:0;transition:opacity .12s ease-in-out;z-index:9999}.qs-icon:hover>.qs-tooltip{opacity:1}.qs-tooltip .qs-tooltip-emph{color:#ff4e4e}.qs-radio:disabled{cursor:not-allowed}.qs-radio:disabled+span{opacity:.6;cursor:not-allowed}.qs-inline-input{padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.45);color:inherit;font-size:14px;width:100%;max-width:240px}.qs-dialog-input{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.35);color:inherit;font-size:14px}.qs-items{margin:10px 0 14px 0;padding:12px;border-left:2px solid rgba(59,130,246,.35);background:rgba(59,130,246,.12);border-radius:8px}.qs-items-body{display:flex;flex-direction:column;gap:4px;font-size:13px;max-height:240px;overflow:auto}.qs-pill{display:inline-flex;align-items:center;justify-content:center;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.12);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.qs-pill--accent{background:linear-gradient(135deg,rgba(59,130,246,.85),rgba(99,102,241,.85))}.qs-pill--version{background:rgba(255,255,255,.12)}.qs-pill--channel{background:rgba(248,113,113,.35)}.qs-confirm-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(2px)}.qs-confirm-dialog{background:var(--spice-section-bg,rgba(32,32,32,.95));border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:20px 22px;max-width:360px;width:min(90vw,360px);box-shadow:0 18px 36px rgba(0,0,0,.45);display:flex;flex-direction:column;gap:16px}.qs-confirm-title{font-size:16px;font-weight:600}.qs-confirm-message{font-size:13px;opacity:.85;line-height:1.5}.qs-confirm-actions{display:flex;gap:10px;justify-content:flex-end}@media (max-width:860px){.qs-header{flex-direction:column;align-items:flex-start}.qs-actions{width:100%;justify-content:flex-start}.qs-row{grid-template-columns:1fr}.qs-row-actions{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}}.qs-toast-container{position:fixed;top:24px;left:24px;display:flex;flex-direction:column;gap:12px;z-index:2147483646;pointer-events:none}.qs-toast{display:flex;align-items:flex-start;gap:10px;min-width:240px;max-width:min(360px,90vw);padding:12px 14px;border-radius:10px;background:rgba(32,32,32,.92);border:1px solid rgba(255,255,255,.07);box-shadow:0 14px 32px rgba(0,0,0,.45);color:var(--spice-text,#fff);font-size:13px;line-height:1.45;pointer-events:auto;transform:translateY(-4px);opacity:0;transition:transform .2s ease,opacity .2s ease;position:relative;overflow:hidden}.qs-toast--enter{opacity:1;transform:translateY(0)}.qs-toast--exit{opacity:0;transform:translateY(-4px)}.qs-toast--swipe-exit{opacity:0;transform:translateX(-160px);transition:transform .2s ease,opacity .2s ease}.qs-toast--dragging{transition:none!important}.qs-toast:focus-within{outline:2px solid rgba(96,165,250,.8);outline-offset:2px}.qs-toast-message{flex:1 1 auto;padding-right:8px}.qs-toast-close{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:0 0;border:none;color:inherit;font-size:18px;line-height:1;cursor:pointer;padding:0 2px;opacity:.7;transition:opacity .12s ease}.qs-toast-close:focus-visible,.qs-toast-close:hover{opacity:1}.qs-toast-close:focus-visible{outline:2px solid rgba(96,165,250,.8);outline-offset:2px}.qs-toast-close--hidden{display:none}.qs-toast-progress{position:absolute;left:10px;right:10px;bottom:8px;height:3px;border-radius:999px;background:rgba(255,255,255,.15);transform-origin:left;transition:opacity .16s ease;opacity:0;pointer-events:none}.qs-toast-progress__bar{width:100%;height:100%;border-radius:inherit;background:rgba(255,255,255,.7);transform-origin:left;transform:scaleX(0);transition:transform 80ms linear}.qs-toast-progress--hidden{opacity:0}.qs-toast-progress--visible{opacity:1}.qs-toast--success .qs-toast-progress__bar{background:rgba(187,247,208,.85)}.qs-toast--danger .qs-toast-progress__bar{background:rgba(254,202,202,.9)}.qs-toast--warning .qs-toast-progress__bar{background:rgba(30,41,59,.9)}.qs-toast--warning .qs-toast-progress{background:rgba(15,23,42,.35)}.qs-toast--success{background:linear-gradient(135deg,rgba(34,197,94,.85),rgba(16,185,129,.85));border-color:rgba(34,197,94,.45)}.qs-toast--danger{background:linear-gradient(135deg,rgba(248,113,113,.92),rgba(220,38,38,.92));border-color:rgba(248,113,113,.55)}.qs-toast--warning{background:linear-gradient(135deg,rgba(250,204,21,.9),rgba(251,191,36,.9));border-color:rgba(234,179,8,.55);color:#1f1f1f}.qs-toast-content{flex:1 1 auto;display:flex;flex-direction:column;gap:4px}.qs-toast-title{font-weight:700;font-size:14px;line-height:1.3}.qs-toast--warning .qs-toast-title{color:#1f1f1f}.qs-toast-message{font-size:13px;line-height:1.45}@media (max-width:860px){.qs-toast-container{left:50%;transform:translateX(-50%);top:12px;gap:10px}.qs-toast{max-width:min(420px,92vw)}}
      `.trim(),document.head.appendChild(e))})()})();